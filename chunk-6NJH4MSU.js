import{a as de}from"./chunk-5WIDQLZN.js";import{a as ce,b as pe}from"./chunk-JYEPO45A.js";import"./chunk-MEBUCGCQ.js";import{a as T,c as B,d as A,g as V}from"./chunk-VTKZNL4V.js";import{a as se}from"./chunk-4UDKM6VP.js";import{a as J,b as Q}from"./chunk-MDRIXYBX.js";import{a as W,c as U,d as G,f as K,g as $,h as ee}from"./chunk-56Q56IV5.js";import{c as re,h as ae}from"./chunk-EFACFY3A.js";import{Ja as ne,Ka as oe,aa as Y,b as z,f as L,fa as q,ga as H,ha as X,i as R,ka as Z,la as te,ma as ie,p as j}from"./chunk-EWSGLXCW.js";import{$a as l,Ab as c,Bb as b,Cb as x,Db as S,Ec as N,Fb as w,Gb as M,Ha as D,Hb as P,Ja as n,Jb as O,Ka as g,bb as a,db as I,eb as y,f as v,gc as F,hb as r,ib as o,ic as k,jb as f,ka as E,nb as h,qb as C,ra as u,sa as _,sb as p}from"./chunk-R7MLKEAJ.js";function ue(t,s){t&1&&(r(0,"div",4),f(1,"mat-spinner",5),r(2,"span"),c(3,"\u8F09\u5165\u4E2D..."),o()())}function _e(t,s){if(t&1&&(r(0,"div",6)(1,"mat-icon"),c(2,"error_outline"),o(),r(3,"p"),c(4),o()()),t&2){let e=p();n(4),b(e.error)}}function ve(t,s){if(t&1&&f(0,"img",25),t&2){let e=p(2);a("src",e.device.image_url,D)("alt",e.device.name)}}function fe(t,s){t&1&&(r(0,"div",26)(1,"mat-icon"),c(2,"smartphone"),o()())}function xe(t,s){if(t&1&&(r(0,"span"),c(1),o()),t&2){let e=p(2);n(),x(" \xB7 ",e.device.model,"")}}function he(t,s){if(t&1&&(r(0,"p",27),c(1),o()),t&2){let e=p(2);n(),S(" ",e.device.os," ",e.device.os_version," ")}}function Ce(t,s){if(t&1&&(r(0,"p",28),c(1),o()),t&2){let e=p(2);n(),b(e.device.notes)}}function be(t,s){t&1&&(r(0,"span"),c(1,"\u53EF\u501F\u7528"),o())}function we(t,s){t&1&&(r(0,"span"),c(1,"\u501F\u7528\u4E2D"),o())}function Me(t,s){t&1&&(r(0,"span"),c(1,"\u7DAD\u4FEE\u4E2D"),o())}function Pe(t,s){if(t&1&&(r(0,"p",31),c(1),o()),t&2){let e=p(3);n(),x(" \u501F\u7528\u6642\u9593\uFF1A",e.formatDate(e.device.borrowed_at)," ")}}function Ee(t,s){if(t&1&&(r(0,"div",29)(1,"p"),c(2),o(),l(3,Pe,2,1,"p",30),o()),t&2){let e=p(2);n(2),x("\u501F\u7528\u8005\uFF1A",e.device.borrower_name,""),n(),a("ngIf",e.device.borrowed_at)}}function De(t,s){t&1&&f(0,"mat-spinner",39)}function Ie(t,s){t&1&&(r(0,"span"),c(1,"\u501F\u7528\u6B64\u8A2D\u5099"),o())}function ye(t,s){if(t&1){let e=h();r(0,"div",32)(1,"mat-form-field",33)(2,"mat-label"),c(3,"\u4F60\u7684\u540D\u5B57"),o(),r(4,"input",34),P("ngModelChange",function(i){u(e);let m=p(2);return M(m.borrowerName,i)||(m.borrowerName=i),_(i)}),o()(),r(5,"mat-form-field",33)(6,"mat-label"),c(7,"Email\uFF08\u9078\u586B\uFF09"),o(),r(8,"input",35),P("ngModelChange",function(i){u(e);let m=p(2);return M(m.borrowerEmail,i)||(m.borrowerEmail=i),_(i)}),o()(),r(9,"mat-form-field",33)(10,"mat-label"),c(11,"\u501F\u7528\u7528\u9014\uFF08\u9078\u586B\uFF09"),o(),r(12,"input",36),P("ngModelChange",function(i){u(e);let m=p(2);return M(m.purpose,i)||(m.purpose=i),_(i)}),o()(),r(13,"button",37),C("click",function(){u(e);let i=p(2);return _(i.borrowDevice())}),l(14,De,1,0,"mat-spinner",38)(15,Ie,2,0,"span",15),o()()}if(t&2){let e=p(2);n(4),w("ngModel",e.borrowerName),a("disabled",e.processing),n(4),w("ngModel",e.borrowerEmail),a("disabled",e.processing),n(4),w("ngModel",e.purpose),a("disabled",e.processing),n(),a("disabled",e.processing||!e.borrowerName.trim()),n(),a("ngIf",e.processing),n(),a("ngIf",!e.processing)}}function Se(t,s){t&1&&f(0,"mat-spinner",39)}function Oe(t,s){t&1&&(r(0,"span"),c(1,"\u6B78\u9084\u6B64\u8A2D\u5099"),o())}function Fe(t,s){if(t&1){let e=h();r(0,"div",40)(1,"button",41),C("click",function(){u(e);let i=p(2);return _(i.returnDevice())}),l(2,Se,1,0,"mat-spinner",38)(3,Oe,2,0,"span",15),o()()}if(t&2){let e=p(2);n(),a("disabled",e.processing),n(),a("ngIf",e.processing),n(),a("ngIf",!e.processing)}}function ke(t,s){t&1&&(r(0,"div",42)(1,"mat-icon"),c(2,"info"),o(),r(3,"p"),c(4,"\u6B64\u8A2D\u5099\u7531\u5176\u4ED6\u7528\u6236\u501F\u7528\u4E2D\uFF0C\u7121\u6CD5\u6B78\u9084"),o()())}function Te(t,s){t&1&&(r(0,"div",43)(1,"mat-icon"),c(2,"build"),o(),r(3,"p"),c(4,"\u6B64\u8A2D\u5099\u76EE\u524D\u7DAD\u4FEE\u4E2D\uFF0C\u66AB\u6642\u7121\u6CD5\u501F\u7528"),o()())}function Be(t,s){if(t&1){let e=h();r(0,"div",7)(1,"a",8)(2,"mat-icon"),c(3,"arrow_back"),o(),c(4," \u8FD4\u56DE\u8A2D\u5099\u5217\u8868 "),o(),r(5,"mat-card",9)(6,"div",10),C("click",function(){u(e);let i=p();return _(i.openImageLightbox(i.device))}),l(7,ve,1,2,"img",11)(8,fe,3,0,"div",12),o(),r(9,"mat-card-content")(10,"h1",13),c(11),o(),r(12,"p",14),c(13),l(14,xe,2,1,"span",15),o(),l(15,he,2,2,"p",16)(16,Ce,2,1,"p",17),r(17,"div",18)(18,"div",19),l(19,be,2,0,"span",15)(20,we,2,0,"span",15)(21,Me,2,0,"span",15),o(),l(22,Ee,4,2,"div",20),o()(),r(23,"mat-card-actions"),l(24,ye,16,9,"div",21)(25,Fe,4,3,"div",22)(26,ke,5,0,"div",23)(27,Te,5,0,"div",24),o()()()}if(t&2){let e=p();n(6),I("clickable",e.device.image_url),n(),a("ngIf",e.device.image_url),n(),a("ngIf",!e.device.image_url),n(3),b(e.device.name),n(2),x(" ",e.device.brand," "),n(),a("ngIf",e.device.model),n(),a("ngIf",e.device.os),n(),a("ngIf",e.device.notes),n(2),y(e.device.status),n(),a("ngIf",e.device.status==="available"),n(),a("ngIf",e.device.status==="borrowed"),n(),a("ngIf",e.device.status==="maintenance"),n(),a("ngIf",e.device.status==="borrowed"&&e.device.borrower_name),n(2),a("ngIf",e.device.status==="available"),n(),a("ngIf",e.device.status==="borrowed"&&e.device.borrower_email===e.currentUserEmail),n(),a("ngIf",e.device.status==="borrowed"&&e.device.borrower_email!==e.currentUserEmail),n(),a("ngIf",e.device.status==="maintenance")}}var st=(()=>{class t{constructor(e,d,i,m,le,me,ge){this.route=e,this.deviceService=d,this.borrowService=i,this.supabase=m,this.snackBar=le,this.dialog=me,this.router=ge,this.device=null,this.loading=!0,this.error=null,this.processing=!1,this.currentUserEmail="",this.borrowerName="",this.borrowerEmail="",this.purpose="",this.STORAGE_KEY_NAME="borrower_name",this.STORAGE_KEY_EMAIL="borrower_email",this.borrowerName=localStorage.getItem(this.STORAGE_KEY_NAME)||"",this.borrowerEmail=localStorage.getItem(this.STORAGE_KEY_EMAIL)||"",this.currentUserEmail=this.supabase.currentUserValue?.email||""}ngOnInit(){let e=this.route.snapshot.paramMap.get("id");e?this.loadDevice(e):(this.error="\u7121\u6548\u7684\u8A2D\u5099\u9023\u7D50",this.loading=!1)}loadDevice(e){return v(this,null,function*(){this.loading=!0,this.error=null;try{this.device=yield this.deviceService.getDevice(e),this.device||(this.error="\u627E\u4E0D\u5230\u6B64\u8A2D\u5099")}catch(d){console.error("Load device error:",d),this.error="\u8F09\u5165\u8A2D\u5099\u8CC7\u8A0A\u5931\u6557"}finally{this.loading=!1}})}borrowDevice(){return v(this,null,function*(){if(!this.device||!this.borrowerName.trim())return;let e=this.borrowerName.trim(),d=this.borrowerEmail.trim()||void 0;this.processing=!0;try{let i=yield this.borrowService.borrowDevice(this.device.id,e,d,this.purpose.trim()||void 0);i.success?(localStorage.setItem(this.STORAGE_KEY_NAME,e),d&&localStorage.setItem(this.STORAGE_KEY_EMAIL,d),this.snackBar.open("\u501F\u7528\u6210\u529F\uFF01","\u95DC\u9589",{duration:3e3}),yield this.loadDevice(this.device.id),this.purpose=""):this.snackBar.open(i.error||"\u501F\u7528\u5931\u6557","\u95DC\u9589",{duration:5e3})}catch(i){console.error("Borrow error:",i),this.snackBar.open(i.message||"\u501F\u7528\u5931\u6557","\u95DC\u9589",{duration:5e3})}finally{this.processing=!1}})}returnDevice(){return v(this,null,function*(){if(!this.device||!this.device.active_borrow_id)return;this.dialog.open(ce,{width:"400px",data:{deviceName:this.device.name}}).afterClosed().subscribe(d=>v(this,null,function*(){if(d&&this.device?.active_borrow_id){this.processing=!0;try{let i=yield this.borrowService.returnDevice(this.device.active_borrow_id);i.success?(this.snackBar.open("\u6B78\u9084\u6210\u529F\uFF01","\u95DC\u9589",{duration:3e3}),yield this.router.navigate(["/"])):this.snackBar.open(i.error||"\u6B78\u9084\u5931\u6557","\u95DC\u9589",{duration:5e3})}catch(i){console.error("Return error:",i),this.snackBar.open(i.message||"\u6B78\u9084\u5931\u6557","\u95DC\u9589",{duration:5e3})}finally{this.processing=!1}}}))})}openImageLightbox(e){e.image_url&&this.dialog.open(de,{data:{imageUrl:e.image_url,title:e.name}})}formatDate(e){return e?new Date(e).toLocaleString("zh-TW",{month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}):""}static{this.\u0275fac=function(d){return new(d||t)(g(T),g(se),g(pe),g(N),g(ne),g(re),g(B))}}static{this.\u0275cmp=E({type:t,selectors:[["app-device-page"]],standalone:!0,features:[O],decls:4,vars:3,consts:[[1,"device-page"],["class","loading",4,"ngIf"],["class","error-state",4,"ngIf"],["class","device-content",4,"ngIf"],[1,"loading"],["diameter","40"],[1,"error-state"],[1,"device-content"],["routerLink","/",1,"back-link"],[1,"device-card"],[1,"device-image",3,"click"],[3,"src","alt",4,"ngIf"],["class","no-image",4,"ngIf"],[1,"device-name"],[1,"device-detail"],[4,"ngIf"],["class","device-os",4,"ngIf"],["class","device-notes",4,"ngIf"],[1,"status-section"],[1,"status-badge"],["class","borrower-info",4,"ngIf"],["class","borrow-form",4,"ngIf"],["class","return-section",4,"ngIf"],["class","other-borrower-notice",4,"ngIf"],["class","maintenance-notice",4,"ngIf"],[3,"src","alt"],[1,"no-image"],[1,"device-os"],[1,"device-notes"],[1,"borrower-info"],["class","borrow-time",4,"ngIf"],[1,"borrow-time"],[1,"borrow-form"],["appearance","outline",1,"full-width"],["matInput","","placeholder","\u8ACB\u8F38\u5165\u4F60\u7684\u540D\u5B57",3,"ngModelChange","ngModel","disabled"],["matInput","","type","email","placeholder","your@email.com",3,"ngModelChange","ngModel","disabled"],["matInput","","placeholder","\u4F8B\uFF1AiOS App \u6E2C\u8A66",3,"ngModelChange","ngModel","disabled"],["mat-raised-button","","color","primary",1,"full-width","action-btn",3,"click","disabled"],["diameter","20",4,"ngIf"],["diameter","20"],[1,"return-section"],["mat-raised-button","","color","warn",1,"full-width","action-btn",3,"click","disabled"],[1,"other-borrower-notice"],[1,"maintenance-notice"]],template:function(d,i){d&1&&(r(0,"div",0),l(1,ue,4,0,"div",1)(2,_e,5,1,"div",2)(3,Be,28,19,"div",3),o()),d&2&&(n(),a("ngIf",i.loading),n(),a("ngIf",!i.loading&&i.error),n(),a("ngIf",!i.loading&&i.device))},dependencies:[k,F,j,z,L,R,K,W,G,U,Z,X,ie,te,H,q,Y,Q,J,ee,$,oe,ae,V,A],styles:[".device-page[_ngcontent-%COMP%]{min-height:100vh;background:var(--app-bg);padding:16px;display:flex;justify-content:center;align-items:flex-start}.device-content[_ngcontent-%COMP%]{width:100%;max-width:400px;display:flex;flex-direction:column;gap:8px}.loading[_ngcontent-%COMP%], .error-state[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;gap:16px;padding:48px;color:var(--app-text-muted)}.error-state[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:64px;width:64px;height:64px;color:var(--app-danger)}.device-card[_ngcontent-%COMP%]{width:100%;margin-top:0;border-radius:3px;overflow:hidden}.back-link[_ngcontent-%COMP%]{display:inline-flex;align-items:center;gap:6px;padding:4px 0;color:var(--app-text-muted);text-decoration:none}.back-link[_ngcontent-%COMP%]:hover{color:var(--app-text)}.back-link[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:18px;width:18px;height:18px}.device-image[_ngcontent-%COMP%]{width:100%;height:200px;background:var(--app-surface-elev);display:flex;align-items:center;justify-content:center;border-radius:3px 3px 0 0;overflow:hidden}.device-image.clickable[_ngcontent-%COMP%]{cursor:zoom-in}.device-image[_ngcontent-%COMP%]:not(.clickable){cursor:default}.device-image[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:100%;object-fit:cover;object-position:top center}.device-image[_ngcontent-%COMP%]   .no-image[_ngcontent-%COMP%]{color:var(--app-text-muted)}.device-image[_ngcontent-%COMP%]   .no-image[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:64px;width:64px;height:64px}.device-name[_ngcontent-%COMP%]{font-size:24px;font-weight:500;margin:16px 0 8px}.device-detail[_ngcontent-%COMP%]{font-size:16px;color:var(--app-text);margin:0 0 4px}.device-os[_ngcontent-%COMP%]{font-size:14px;color:var(--app-text-muted);margin:0 0 8px}.device-notes[_ngcontent-%COMP%]{font-size:14px;color:var(--app-text-muted);margin:8px 0;padding:8px;background:var(--app-surface);border-radius:3px}.status-section[_ngcontent-%COMP%]{margin:16px 0}.status-badge[_ngcontent-%COMP%]{display:inline-block;padding:6px 16px;border-radius:3px;font-size:14px;font-weight:500}.status-badge.available[_ngcontent-%COMP%]{background:var(--app-success-bg);color:var(--app-success)}.status-badge.borrowed[_ngcontent-%COMP%]{background:var(--app-danger-bg);color:var(--app-danger)}.status-badge.maintenance[_ngcontent-%COMP%]{background:var(--app-warning-bg);color:var(--app-warning)}.borrower-info[_ngcontent-%COMP%]{margin-top:12px;padding:12px;background:var(--app-danger-bg);border-radius:3px}.borrower-info[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0;font-size:14px}.borrower-info[_ngcontent-%COMP%]   .borrow-time[_ngcontent-%COMP%]{color:var(--app-text-muted);margin-top:4px}.borrow-form[_ngcontent-%COMP%], .return-section[_ngcontent-%COMP%]{padding:16px}.full-width[_ngcontent-%COMP%]{width:100%}.action-btn[_ngcontent-%COMP%]{height:48px;font-size:16px;margin-top:8px}.action-btn[_ngcontent-%COMP%]   mat-spinner[_ngcontent-%COMP%]{display:inline-block;margin-right:8px}.maintenance-notice[_ngcontent-%COMP%], .other-borrower-notice[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;gap:8px;padding:24px;color:var(--app-text-muted)}.maintenance-notice[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%], .other-borrower-notice[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:48px;width:48px;height:48px}.other-borrower-notice[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0;text-align:center}"]})}}return t})();export{st as DevicePageComponent};
