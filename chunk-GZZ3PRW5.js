import{a as ce,b as se}from"./chunk-J6LPEPEW.js";import{a as T,c as A,d as B,g as V}from"./chunk-PAKVZ7YK.js";import{c as oe,h as ae,i as re,j as de}from"./chunk-HBF5AA77.js";import{a as j,c as W,d as G,f as K,g as J,k as Q,l as X,m as Z,n as $,o as ee,p as te,q as ie,r as ne}from"./chunk-IULNBF3J.js";import{b as z,ba as Y,da as U,ea as q,f as L,fa as H,i as N,o as R}from"./chunk-O6CXBG2O.js";import{$a as l,Ab as c,Bb as b,Cb as x,Db as S,Fb as w,Gb as M,Ha as I,Hb as P,Ja as n,Jb as O,Ka as _,bb as r,db as y,eb as D,f as v,gc as k,hb as a,ib as o,ic as F,jb as f,ka as E,nb as h,qb as C,ra as g,sa as u,sb as p}from"./chunk-RS4Y4S6U.js";function me(t,s){t&1&&(a(0,"div",4),f(1,"mat-spinner",5),a(2,"span"),c(3,"\u8F09\u5165\u4E2D..."),o()())}function ge(t,s){if(t&1&&(a(0,"div",6)(1,"mat-icon"),c(2,"error_outline"),o(),a(3,"p"),c(4),o()()),t&2){let e=p();n(4),b(e.error)}}function ue(t,s){if(t&1&&f(0,"img",24),t&2){let e=p(2);r("src",e.device.image_url,I)("alt",e.device.name)}}function _e(t,s){t&1&&(a(0,"div",25)(1,"mat-icon"),c(2,"smartphone"),o()())}function ve(t,s){if(t&1&&(a(0,"span"),c(1),o()),t&2){let e=p(2);n(),x(" \xB7 ",e.device.model,"")}}function fe(t,s){if(t&1&&(a(0,"p",26),c(1),o()),t&2){let e=p(2);n(),S(" ",e.device.os," ",e.device.os_version," ")}}function xe(t,s){if(t&1&&(a(0,"p",27),c(1),o()),t&2){let e=p(2);n(),b(e.device.notes)}}function he(t,s){t&1&&(a(0,"span"),c(1,"\u53EF\u501F\u7528"),o())}function Ce(t,s){t&1&&(a(0,"span"),c(1,"\u501F\u7528\u4E2D"),o())}function be(t,s){t&1&&(a(0,"span"),c(1,"\u7DAD\u4FEE\u4E2D"),o())}function we(t,s){if(t&1&&(a(0,"p",30),c(1),o()),t&2){let e=p(3);n(),x(" \u501F\u7528\u6642\u9593\uFF1A",e.formatDate(e.device.borrowed_at)," ")}}function Me(t,s){if(t&1&&(a(0,"div",28)(1,"p"),c(2),o(),l(3,we,2,1,"p",29),o()),t&2){let e=p(2);n(2),x("\u501F\u7528\u8005\uFF1A",e.device.borrower_name,""),n(),r("ngIf",e.device.borrowed_at)}}function Pe(t,s){t&1&&f(0,"mat-spinner",38)}function Ee(t,s){t&1&&(a(0,"span"),c(1,"\u501F\u7528\u6B64\u8A2D\u5099"),o())}function Ie(t,s){if(t&1){let e=h();a(0,"div",31)(1,"mat-form-field",32)(2,"mat-label"),c(3,"\u4F60\u7684\u540D\u5B57"),o(),a(4,"input",33),P("ngModelChange",function(i){g(e);let m=p(2);return M(m.borrowerName,i)||(m.borrowerName=i),u(i)}),o()(),a(5,"mat-form-field",32)(6,"mat-label"),c(7,"Email\uFF08\u9078\u586B\uFF09"),o(),a(8,"input",34),P("ngModelChange",function(i){g(e);let m=p(2);return M(m.borrowerEmail,i)||(m.borrowerEmail=i),u(i)}),o()(),a(9,"mat-form-field",32)(10,"mat-label"),c(11,"\u501F\u7528\u7528\u9014\uFF08\u9078\u586B\uFF09"),o(),a(12,"input",35),P("ngModelChange",function(i){g(e);let m=p(2);return M(m.purpose,i)||(m.purpose=i),u(i)}),o()(),a(13,"button",36),C("click",function(){g(e);let i=p(2);return u(i.borrowDevice())}),l(14,Pe,1,0,"mat-spinner",37)(15,Ee,2,0,"span",15),o()()}if(t&2){let e=p(2);n(4),w("ngModel",e.borrowerName),r("disabled",e.processing),n(4),w("ngModel",e.borrowerEmail),r("disabled",e.processing),n(4),w("ngModel",e.purpose),r("disabled",e.processing),n(),r("disabled",e.processing||!e.borrowerName.trim()),n(),r("ngIf",e.processing),n(),r("ngIf",!e.processing)}}function ye(t,s){t&1&&f(0,"mat-spinner",38)}function De(t,s){t&1&&(a(0,"span"),c(1,"\u6B78\u9084\u6B64\u8A2D\u5099"),o())}function Se(t,s){if(t&1){let e=h();a(0,"div",39)(1,"button",40),C("click",function(){g(e);let i=p(2);return u(i.returnDevice())}),l(2,ye,1,0,"mat-spinner",37)(3,De,2,0,"span",15),o()()}if(t&2){let e=p(2);n(),r("disabled",e.processing),n(),r("ngIf",e.processing),n(),r("ngIf",!e.processing)}}function Oe(t,s){t&1&&(a(0,"div",41)(1,"mat-icon"),c(2,"build"),o(),a(3,"p"),c(4,"\u6B64\u8A2D\u5099\u76EE\u524D\u7DAD\u4FEE\u4E2D\uFF0C\u66AB\u6642\u7121\u6CD5\u501F\u7528"),o()())}function ke(t,s){if(t&1){let e=h();a(0,"div",7)(1,"a",8)(2,"mat-icon"),c(3,"arrow_back"),o(),c(4," \u8FD4\u56DE\u8A2D\u5099\u5217\u8868 "),o(),a(5,"mat-card",9)(6,"div",10),C("click",function(){g(e);let i=p();return u(i.openImageLightbox(i.device))}),l(7,ue,1,2,"img",11)(8,_e,3,0,"div",12),o(),a(9,"mat-card-content")(10,"h1",13),c(11),o(),a(12,"p",14),c(13),l(14,ve,2,1,"span",15),o(),l(15,fe,2,2,"p",16)(16,xe,2,1,"p",17),a(17,"div",18)(18,"div",19),l(19,he,2,0,"span",15)(20,Ce,2,0,"span",15)(21,be,2,0,"span",15),o(),l(22,Me,4,2,"div",20),o()(),a(23,"mat-card-actions"),l(24,Ie,16,9,"div",21)(25,Se,4,3,"div",22)(26,Oe,5,0,"div",23),o()()()}if(t&2){let e=p();n(6),y("clickable",e.device.image_url),n(),r("ngIf",e.device.image_url),n(),r("ngIf",!e.device.image_url),n(3),b(e.device.name),n(2),x(" ",e.device.brand," "),n(),r("ngIf",e.device.model),n(),r("ngIf",e.device.os),n(),r("ngIf",e.device.notes),n(2),D(e.device.status),n(),r("ngIf",e.device.status==="available"),n(),r("ngIf",e.device.status==="borrowed"),n(),r("ngIf",e.device.status==="maintenance"),n(),r("ngIf",e.device.status==="borrowed"&&e.device.borrower_name),n(2),r("ngIf",e.device.status==="available"),n(),r("ngIf",e.device.status==="borrowed"),n(),r("ngIf",e.device.status==="maintenance")}}var at=(()=>{class t{constructor(e,d,i,m,pe,le){this.route=e,this.deviceService=d,this.borrowService=i,this.snackBar=m,this.dialog=pe,this.router=le,this.device=null,this.loading=!0,this.error=null,this.processing=!1,this.borrowerName="",this.borrowerEmail="",this.purpose="",this.STORAGE_KEY_NAME="borrower_name",this.STORAGE_KEY_EMAIL="borrower_email",this.borrowerName=localStorage.getItem(this.STORAGE_KEY_NAME)||"",this.borrowerEmail=localStorage.getItem(this.STORAGE_KEY_EMAIL)||""}ngOnInit(){let e=this.route.snapshot.paramMap.get("id");e?this.loadDevice(e):(this.error="\u7121\u6548\u7684\u8A2D\u5099\u9023\u7D50",this.loading=!1)}loadDevice(e){return v(this,null,function*(){this.loading=!0,this.error=null;try{this.device=yield this.deviceService.getDevice(e),this.device||(this.error="\u627E\u4E0D\u5230\u6B64\u8A2D\u5099")}catch(d){console.error("Load device error:",d),this.error="\u8F09\u5165\u8A2D\u5099\u8CC7\u8A0A\u5931\u6557"}finally{this.loading=!1}})}borrowDevice(){return v(this,null,function*(){if(!this.device||!this.borrowerName.trim())return;let e=this.borrowerName.trim(),d=this.borrowerEmail.trim()||void 0;this.processing=!0;try{let i=yield this.borrowService.borrowDevice(this.device.id,e,d,this.purpose.trim()||void 0);i.success?(localStorage.setItem(this.STORAGE_KEY_NAME,e),d&&localStorage.setItem(this.STORAGE_KEY_EMAIL,d),this.snackBar.open("\u501F\u7528\u6210\u529F\uFF01","\u95DC\u9589",{duration:3e3}),yield this.loadDevice(this.device.id),this.purpose=""):this.snackBar.open(i.error||"\u501F\u7528\u5931\u6557","\u95DC\u9589",{duration:5e3})}catch(i){console.error("Borrow error:",i),this.snackBar.open(i.message||"\u501F\u7528\u5931\u6557","\u95DC\u9589",{duration:5e3})}finally{this.processing=!1}})}returnDevice(){return v(this,null,function*(){if(!this.device||!this.device.active_borrow_id)return;this.dialog.open(re,{width:"320px",data:{title:"\u78BA\u8A8D\u6B78\u9084",message:`\u78BA\u5B9A\u8981\u6B78\u9084\u300C${this.device.name}\u300D\u55CE\uFF1F`,confirmText:"\u78BA\u8A8D\u6B78\u9084",cancelText:"\u53D6\u6D88"}}).afterClosed().subscribe(d=>v(this,null,function*(){if(d&&this.device?.active_borrow_id){this.processing=!0;try{let i=yield this.borrowService.returnDevice(this.device.active_borrow_id);i.success?(this.snackBar.open("\u6B78\u9084\u6210\u529F\uFF01","\u95DC\u9589",{duration:3e3}),yield this.router.navigate(["/"])):this.snackBar.open(i.error||"\u6B78\u9084\u5931\u6557","\u95DC\u9589",{duration:5e3})}catch(i){console.error("Return error:",i),this.snackBar.open(i.message||"\u6B78\u9084\u5931\u6557","\u95DC\u9589",{duration:5e3})}finally{this.processing=!1}}}))})}openImageLightbox(e){e.image_url&&this.dialog.open(ce,{data:{imageUrl:e.image_url,title:e.name}})}formatDate(e){return e?new Date(e).toLocaleString("zh-TW",{month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}):""}static{this.\u0275fac=function(d){return new(d||t)(_(T),_(de),_(se),_(ie),_(oe),_(A))}}static{this.\u0275cmp=E({type:t,selectors:[["app-device-page"]],standalone:!0,features:[O],decls:4,vars:3,consts:[[1,"device-page"],["class","loading",4,"ngIf"],["class","error-state",4,"ngIf"],["class","device-content",4,"ngIf"],[1,"loading"],["diameter","40"],[1,"error-state"],[1,"device-content"],["routerLink","/",1,"back-link"],[1,"device-card"],[1,"device-image",3,"click"],[3,"src","alt",4,"ngIf"],["class","no-image",4,"ngIf"],[1,"device-name"],[1,"device-detail"],[4,"ngIf"],["class","device-os",4,"ngIf"],["class","device-notes",4,"ngIf"],[1,"status-section"],[1,"status-badge"],["class","borrower-info",4,"ngIf"],["class","borrow-form",4,"ngIf"],["class","return-section",4,"ngIf"],["class","maintenance-notice",4,"ngIf"],[3,"src","alt"],[1,"no-image"],[1,"device-os"],[1,"device-notes"],[1,"borrower-info"],["class","borrow-time",4,"ngIf"],[1,"borrow-time"],[1,"borrow-form"],["appearance","outline",1,"full-width"],["matInput","","placeholder","\u8ACB\u8F38\u5165\u4F60\u7684\u540D\u5B57",3,"ngModelChange","ngModel","disabled"],["matInput","","type","email","placeholder","your@email.com",3,"ngModelChange","ngModel","disabled"],["matInput","","placeholder","\u4F8B\uFF1AiOS App \u6E2C\u8A66",3,"ngModelChange","ngModel","disabled"],["mat-raised-button","","color","primary",1,"full-width","action-btn",3,"click","disabled"],["diameter","20",4,"ngIf"],["diameter","20"],[1,"return-section"],["mat-raised-button","","color","warn",1,"full-width","action-btn",3,"click","disabled"],[1,"maintenance-notice"]],template:function(d,i){d&1&&(a(0,"div",0),l(1,me,4,0,"div",1)(2,ge,5,1,"div",2)(3,ke,27,18,"div",3),o()),d&2&&(n(),r("ngIf",i.loading),n(),r("ngIf",!i.loading&&i.error),n(),r("ngIf",!i.loading&&i.device))},dependencies:[F,k,R,z,L,N,K,j,G,W,U,Y,H,q,X,Q,J,$,Z,te,ee,ne,ae,V,B],styles:[".device-page[_ngcontent-%COMP%]{min-height:100vh;background:var(--app-bg);padding:16px;display:flex;justify-content:center;align-items:flex-start}.device-content[_ngcontent-%COMP%]{width:100%;max-width:400px;display:flex;flex-direction:column;gap:8px}.loading[_ngcontent-%COMP%], .error-state[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;gap:16px;padding:48px;color:var(--app-text-muted)}.error-state[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:64px;width:64px;height:64px;color:var(--app-danger)}.device-card[_ngcontent-%COMP%]{width:100%;margin-top:0;border-radius:3px;overflow:hidden}.back-link[_ngcontent-%COMP%]{display:inline-flex;align-items:center;gap:6px;padding:4px 0;color:var(--app-text-muted);text-decoration:none}.back-link[_ngcontent-%COMP%]:hover{color:var(--app-text)}.back-link[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:18px;width:18px;height:18px}.device-image[_ngcontent-%COMP%]{width:100%;height:200px;background:var(--app-surface-elev);display:flex;align-items:center;justify-content:center;border-radius:3px 3px 0 0;overflow:hidden}.device-image.clickable[_ngcontent-%COMP%]{cursor:zoom-in}.device-image[_ngcontent-%COMP%]:not(.clickable){cursor:default}.device-image[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:100%;object-fit:cover;object-position:top center}.device-image[_ngcontent-%COMP%]   .no-image[_ngcontent-%COMP%]{color:var(--app-text-muted)}.device-image[_ngcontent-%COMP%]   .no-image[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:64px;width:64px;height:64px}.device-name[_ngcontent-%COMP%]{font-size:24px;font-weight:500;margin:16px 0 8px}.device-detail[_ngcontent-%COMP%]{font-size:16px;color:var(--app-text);margin:0 0 4px}.device-os[_ngcontent-%COMP%]{font-size:14px;color:var(--app-text-muted);margin:0 0 8px}.device-notes[_ngcontent-%COMP%]{font-size:14px;color:var(--app-text-muted);margin:8px 0;padding:8px;background:var(--app-surface);border-radius:3px}.status-section[_ngcontent-%COMP%]{margin:16px 0}.status-badge[_ngcontent-%COMP%]{display:inline-block;padding:6px 16px;border-radius:3px;font-size:14px;font-weight:500}.status-badge.available[_ngcontent-%COMP%]{background:var(--app-success-bg);color:var(--app-success)}.status-badge.borrowed[_ngcontent-%COMP%]{background:var(--app-danger-bg);color:var(--app-danger)}.status-badge.maintenance[_ngcontent-%COMP%]{background:var(--app-warning-bg);color:var(--app-warning)}.borrower-info[_ngcontent-%COMP%]{margin-top:12px;padding:12px;background:var(--app-danger-bg);border-radius:3px}.borrower-info[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0;font-size:14px}.borrower-info[_ngcontent-%COMP%]   .borrow-time[_ngcontent-%COMP%]{color:var(--app-text-muted);margin-top:4px}.borrow-form[_ngcontent-%COMP%], .return-section[_ngcontent-%COMP%]{padding:16px}.full-width[_ngcontent-%COMP%]{width:100%}.action-btn[_ngcontent-%COMP%]{height:48px;font-size:16px;margin-top:8px}.action-btn[_ngcontent-%COMP%]   mat-spinner[_ngcontent-%COMP%]{display:inline-block;margin-right:8px}.maintenance-notice[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;gap:8px;padding:24px;color:var(--app-text-muted)}.maintenance-notice[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:48px;width:48px;height:48px}"]})}}return t})();export{at as DevicePageComponent};
