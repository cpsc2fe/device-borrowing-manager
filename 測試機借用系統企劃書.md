# 測試機借用系統企劃書

## 📖 專案概述

### 專案名稱

測試機借用管理系統 (Device Borrowing Management System)

### 專案背景

為了有效管理公司/組織內的測試設備，包括手機、平板、開發板等各種測試機器，需要建立一個完整的借用管理系統，確保設備的合理分配使用並追蹤設備狀態。

### 專案目標

1. **提升設備管理效率** - 建立統一的設備借用平台
2. **權限控制管理** - 確保只有授權人員可以管理設備
3. **使用追蹤** - 完整記錄設備的借用歷史
4. **狀態監控** - 即時掌握設備的可用性和狀況
5. **資源優化** - 避免設備閒置或重複借用

---

## 🏗️ 技術架構

### 前端技術

- **框架**: Angular 17+ (最新版本)
- **UI 框架**: Angular Material
- **狀態管理**: NgRx (適用於複雜狀態管理)
- **HTTP 客戶端**: Angular HttpClient
- **圖片處理**: ng-image-compress
- **日期處理**: date-fns
- **表格組件**: Angular Material Table

### 後端技術

- **BaaS 平台**: Supabase (免費方案)
- **資料庫**: PostgreSQL (Supabase 內建)
- **認證**: Supabase Auth
- **檔案儲存**: Supabase Storage (免費 1GB)
- **即時更新**: Supabase Realtime
- **Telegram 整合**: Telegram Bot API (免費)
- **通知服務**: Supabase Database Webhooks + 簡單函數

### 開發工具

- **IDE**: VS Code (免費)
- **版本控制**: Git (免費)
- **套件管理**: npm (免費)
- **部署**: Netlify (免費方案)

---

## 👥 使用者角色與權限

### 1. 管理員 (Admin)

**權限範圍：**

- 所有系統功能的完整存取權限
- 使用者帳號管理（新增、編輯、刪除、權限變更）
- 設備管理（新增、編輯、刪除）
- 設備狀態更新
- 設備歸還確認
- 設備維護記錄管理
- 系統設定管理
- 資料備份與匯出
- 審計日誌查看

**主要功能：**

- 管理所有使用者帳號 (透過 Email)
- 新增/編輯測試機資訊
- 上傳設備照片
- 設定設備可借用狀態
- 查看所有借用/歸還記錄
- 設備維護排程
- 設定系統參數
- 設備分類管理
- 設定 Telegram 群組通知

### 2. 一般使用者 (User)

**權限範圍：**

- 瀏覽可借用設備
- 提交借用申請
- 查看個人借用記錄
- 設備歸還申請

**主要功能：**

- 搜尋與篩選設備
- 申請借用設備
- 查看個人借用狀況
- 延長借用申請
- 設備歸還

---

## 📱 功能模組設計

### 1. 使用者認證模組

#### 1.1 登入/登出

- Email + 密碼登入
- 記住登入狀態
- 自動登出機制

#### 1.2 密碼管理

- 忘記密碼重設
- 密碼強度檢測
- 定期密碼更新提醒

### 2. 設備管理模組

#### 2.1 設備基本資訊

- **設備 ID**: 自動生成的唯一識別碼
- **設備名稱**: 如 "iPhone 15 Pro"
- **設備型號**: 詳細型號資訊
- **作業系統**: iOS, Android 等
- **規格資訊**(可選): CPU, RAM, 儲存空間等
- **設備類型**: 手機、平板
- **品牌分類**: Apple, Samsung, Google 等

#### 2.2 設備照片管理

- **多角度照片**: 正面、背面、側面
- **照片壓縮**: 自動壓縮以節省儲存空間

#### 2.3 設備狀態管理

- **可借用**: 設備可正常借用
- **已借出**: 設備目前被借用中
- **維修中**: 設備正在維修
- **報廢**: 設備已無法使用
- **保留**: 設備暫時保留不可借用

### 3. 借用管理模組

#### 3.1 借用申請

- **設備選擇**: 支援多選設備借用
- **借用期間**: 開始與結束日期時間
- **借用目的**: 測試項目、開發需求等
- **備註**: 特殊需求說明

#### 3.2 自動借用流程

- **申請提交**: 使用者提交借用申請
- **衝突檢查**: 自動檢查設備可用性與時間衝突
- **自動確認**: 系統自動確認借用，更新設備狀態
- **TG 群組通知**: 自動在 Telegram 群組中發布借用狀況

#### 3.3 設備取用

- **自動分配**: 系統自動分配可用設備
- **QR Code**: 生成 QR Code 便於快速借用
- **狀態更新**: 自動將設備狀態更為「已借出」

#### 3.4 歸還管理

- **歸還申請**: 使用者申請歸還設備
- **自動確認**: 系統自動確認歸還，更新設備狀態
- **TG 群組通知**: 自動在 Telegram 群組中發布歸還狀況
- **損壞回報**: (可選) 使用者可回報設備損壞情況

### 4. 通知系統模組

#### 4.1 Telegram 群組通知

- **借用通知**: 設備借用時自動發布消息
- **歸還通知**: 設備歸還時自動發布消息
- **即時狀況**: 顯示所有設備的目前借用狀況
- **逾期提醒**: 自動提醒逾期未歸還的設備(每天一次)

#### 4.2 系統內通知

- 即時推送通知
- 通知歷史記錄
- 未讀通知計數
- 通知偏好設定

#### 4.4 Telegram 通知詳細說明

**借用通知格式：**

```
📱 設備借用通知
設備：iPhone 15 Pro (ID: DEV001)
借用者：user@example.com
借用時間：2026-01-14 09:00 ~ 2026-01-16 18:00
用途：iOS 測試

目前借用狀況：
📱 iPhone 15 Pro - user@example.com (至 01/16)
📱 Samsung S24 - admin@example.com (至 01/15)
💻 MacBook Pro - test@example.com (至 01/20)
```

**歸還通知格式：**

```
✅ 設備歸還通知
設備：iPhone 15 Pro (ID: DEV001)
歸還者：user@example.com
歸還時間：2026-01-15 15:30

目前可借用設備：
📱 iPhone 15 Pro ✅
📱 Samsung S24 - admin@example.com (至 01/15)
💻 MacBook Pro - test@example.com (至 01/20)
```

### 5. 系統管理模組

#### 6.1 使用者管理

- 使用者帳號 CRUD (透過 Email 建立)
- 權限角色分配
- 大量使用者匯入 (Email 清單)

#### 6.2 系統設定

- **借用規則**: 最長借用期限、同時借用數量限制
- **通知設定**: 各種通知的開關與時間
- **Telegram 設定**: Bot Token、群組 Chat ID、Thread ID (可選)

---

## 📊 資料庫設計

### 核心資料表

#### users (使用者資料表)

```sql
- id (UUID, Primary Key)
- email (String, Unique)
- password_hash (String)
- role (Enum: admin, user)
- is_active (Boolean)
- last_login (Timestamp)
- created_at (Timestamp)
- updated_at (Timestamp)
```

#### devices (設備資料表)

```sql
- id (UUID, Primary Key)
- device_name (String)
- brand (String)
- model (String)
- device_type (Enum: phone, tablet, laptop, other)
- operating_system (String)
- os_version (String)
- specifications (JSONB)
- asset_number (String, Unique)
- purchase_date (Date)
- warranty_end_date (Date)
- location (String)
- status (Enum: available, borrowed, maintenance, retired, reserved)
- condition (Enum: excellent, good, fair, poor)
- notes (Text)
- created_by (UUID, Foreign Key)
- created_at (Timestamp)
- updated_at (Timestamp)
```

#### device_images (設備圖片資料表)

```sql
- id (UUID, Primary Key)
- device_id (UUID, Foreign Key)
- image_url (String)
- image_type (Enum: front, back, side, detail, damage)
- description (String)
- uploaded_by (UUID, Foreign Key)
- created_at (Timestamp)
```

#### borrow_requests (借用申請資料表)

```sql
- id (UUID, Primary Key)
- user_id (UUID, Foreign Key)
- device_id (UUID, Foreign Key)
- requested_start_date (Timestamp)
- requested_end_date (Timestamp)
- actual_start_date (Timestamp)
- actual_end_date (Timestamp)
- purpose (Text)
- priority (Enum: high, medium, low)
- status (Enum: confirmed, active, completed, overdue, cancelled)
- notes (Text)
- created_at (Timestamp)
- updated_at (Timestamp)
```

#### maintenance_records (維護記錄資料表)

```sql
- id (UUID, Primary Key)
- device_id (UUID, Foreign Key)
- maintenance_type (Enum: routine, repair, upgrade, inspection)
- description (Text)
- cost (Decimal)
- vendor (String)
- start_date (Date)
- end_date (Date)
- performed_by (UUID, Foreign Key)
- status (Enum: scheduled, in_progress, completed, cancelled)
- created_at (Timestamp)
- updated_at (Timestamp)
```

#### notifications (通知資料表)

```sql
- id (UUID, Primary Key)
- user_id (UUID, Foreign Key)
- type (Enum: borrow_confirmed, return_reminder, overdue_warning, maintenance_alert)
- title (String)
- message (Text)
- is_read (Boolean)
- created_at (Timestamp)
```

#### telegram_settings (系統設定資料表)

```sql
- id (UUID, Primary Key)
- bot_token (String)
- chat_id (String)
- thread_id (String, 可為空)
- is_enabled (Boolean)
- created_at (Timestamp)
- updated_at (Timestamp)
```

---

## 🎨 使用者介面設計

### 1. 設計原則

- **響應式設計**: 支援桌面、平板、手機
- **直覺操作**: 符合使用者習慣的介面設計
- **無障礙設計**: 符合 WCAG 2.1 規範
- **一致性**: 統一的設計語言與互動模式

### 2. 主要頁面規劃

#### 2.1 登入頁面

- 簡潔的登入表單
- 忘記密碼連結
- 記住登入狀態選項

#### 2.2 首頁 (Dashboard)

- **系統概覽卡片**: 總設備數、可借用數、已借出數
- **個人狀態**: 個人當前借用設備、待歸還提醒
- **快捷功能**: 快速搜尋設備、我的申請記錄
- **最新動態**: 系統公告、重要通知

#### 2.3 設備瀏覽頁面

- **設備卡片**: 顯示設備圖片、基本資訊、狀態

#### 2.4 設備詳細頁面

- **設備照片輪播**: 多角度設備照片
- **詳細規格**: 完整的設備資訊
- **借用歷史**: 過往借用記錄
- **借用按鈕**: 快速申請借用

#### 2.5 借用記錄頁面

- **我的借用**: 個人借用記錄與狀態
- **借用歷史**: 完整的借用記錄
- **歸還提醒**: 即將到期的設備提醒
- **快速歸還**: 一鍵歸還按鈕

#### 2.6 設備管理頁面 (管理員)

- **設備列表**: 完整設備清單管理
- **新增設備**: 設備資訊輸入表單
- **批次操作**: 支援批次狀態更新
- **匯入功能**: Excel 批次匯入設備

### 3. 行動端適配

- **底部導航列**: 主要功能快速存取
- **滑動手勢**: 支援滑動操作
- **觸控優化**: 適合手指點擊的按鈕大小
- **離線瀏覽**: 基本資訊離線快取

---

## 🔐 安全性考量

### 1. 身份驗證安全

- **密碼複雜度要求**: 最少 8 位元，包含大小寫英文、數字、特殊字元
- **Session 管理**: 自動過期與強制登出

### 2. 資料安全

- **資料加密**: 敏感資料加密儲存
- **HTTPS 連線**: 強制使用 SSL/TLS
- **SQL 注入防護**: 使用參數化查詢
- **XSS 防護**: 輸入資料清理與驗證

### 3. 檔案安全

- **檔案類型限制**: 僅允許指定圖片格式
- **檔案大小限制**: 防止大檔案攻擊
- **存取控制**: 基於角色的檔案存取權限

### 4. API 安全

- **Rate Limiting**: API 呼叫頻率限制
- **JWT Token**: 安全的 API 認證機制
- **CORS 設定**: 跨域請求安全控制
- **API 版本控制**: 向後相容性管理

---

## 📈 效能優化

### 1. 前端效能

- **Lazy Loading**: 模組與圖片延遲載入
- **圖片優化**: 自動壓縮與格式轉換
- **快取策略**: 瀏覽器快取與 Service Worker
- **打包優化**: Tree shaking 與程式碼分割

### 2. 後端效能

- **資料庫索引**: 關鍵欄位建立索引
- **查詢優化**: N+1 問題避免
- **連線池**: 資料庫連線池管理
- **CDN 部署**: 靜態資源 CDN 加速

### 3. 監控與維護

- **效能監控**: 頁面載入時間追蹤
- **錯誤追蹤**: 自動錯誤回報機制
- **使用分析**: 使用者行為分析
- **系統監控**: 伺服器資源監控

---

## 🚀 部署策略

### 1. 開發環境

- **本地開發**: Docker Compose 環境設定
- **測試資料**: Mock 資料產生器
- **熱重載**: 開發時即時更新
- **除錯工具**: 前後端除錯工具整合

### 2. 測試環境

- **自動化測試**: 單元測試與整合測試
- **E2E 測試**: Cypress 或 Playwright

### 3. 生產環境

- **自動部署**: Netlify 連接 GitHub repo 自動部署
- **環境分離**: 開發、正式環境分離
- **備份策略**: Supabase 自動備份

---

## 📅 開發時程 (簡單版)

### Week 1-2: 基礎設定

- [ ] 建立 Angular 專案
- [ ] 設定 Supabase 帳號與資料庫
- [ ] 基本 UI 組件 (Angular Material)
- [ ] 登入/登出功能

### Week 3-4: 核心功能

- [ ] 設備 CRUD (新增/編輯/檢視設備)
- [ ] 照片上傳功能
- [ ] 基本借用/歸還流程

### Week 5-6: 進階功能

- [ ] Telegram Bot 設定與整合
- [ ] 自動通知功能
- [ ] 借用歷史查詢

### Week 7: 測試與部署

- [ ] 功能測試
- [ ] Netlify 部署設定
- [ ] 團隊測試與回饋

**總時間: 約 7-8 週** (如果是利用空閒時間做的話)

---

## 💰 成本評估

### 開發成本

- **人力成本**: 有時間的話自己做就好 (免費!)
- **開發工具**: 全部免費

### 營運成本 (月費)

- **Supabase**: 免費方案 (2 個專案, 500MB 資料庫, 1GB 檔案儲存)
- **Netlify**: 免費方案 (100GB 頻寬, 自動 HTTPS)
- **Telegram Bot**: 免費
- **網域**: 可用 Netlify 提供的免費網域

**總計: 完全免費!** 🎉

### 免費方案限制

- **Supabase**: 月 50,000 資料庫讀取 (4 台測試機絕對夠用)
- **Netlify**: 月 100GB 頻寬 (小團隊用不完)
- **檔案儲存**: 1GB (四台測試機照片很夠)

---

## 🎯 成功指標

### 基本目標

- **設備不會搞丟**: 四台測試機都能正常追蹤
- **大家都知道誰在用**: Telegram 群組讓狀況透明
- **不會重複借用**: 避免兩個人同時要用同一台
- **簡單好用**: 團隊成員都能輕鬆上手

### 實用性

- **借用方便**: 不用跑來跑去問誰有空的機器
- **狀況透明**: 一眼就知道哪台可以借
- **自動通知**: 不用手動更新群組狀況
- **記錄完整**: 知道機器的使用歷史

---

## ⚠️ 風險評估與應對策略

### 技術風險

**風險**: Angular 版本升級問題
**應對**: 選擇 LTS 版本，定期更新策略

**風險**: Supabase 服務中斷
**應對**: 建立資料備份機制，考慮多雲備援

**風險**: 效能瓶頸
**應對**: 早期效能測試，優化策略準備

### 使用者風險

**風險**: 使用者接受度低
**應對**: 充分的使用者訓練，逐步功能導入

**風險**: 操作錯誤導致設備遺失
**應對**: 完整的操作記錄，責任歸屬機制

### 安全風險

**風險**: 資料洩漏
**應對**: 多層次安全防護，定期安全評估

**風險**: 未授權存取
**應對**: 強化認證機制，權限最小化原則

---

## 📝 結論

這個測試機借用系統專案設計具備了基礎的設備管理功能，透過 Angular + Supabase 的技術組合，能夠快速建立一個功能完整、安全可靠的管理系統。

專案的成功關鍵在於：

1. **完整的需求分析** - 涵蓋所有可能的使用情境
2. **良好的技術架構** - 確保系統的擴展性與維護性
3. **使用者體驗設計** - 簡單直覺的操作介面
4. **安全性考量** - 多層次的安全防護機制
5. **逐步導入策略** - 降低變革風險，提升接受度
