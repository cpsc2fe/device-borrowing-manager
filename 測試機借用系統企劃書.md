# 測試機借用系統企劃書

## 專案概述

### 專案名稱
測試機借用管理系統 (Device Borrowing Manager)

### 專案背景
管理團隊內 **4 台測試設備**，提供約 **20 人小團隊** 使用的簡單借用系統。

### 核心目標
1. **一眼看清狀態** - 誰在用哪台機器
2. **借用流程簡單** - 3 步驟內完成借用
3. **自動通知** - Telegram 群組同步借用狀況
4. **免費運營** - 使用免費雲端服務

---

## 技術架構

### 前端
| 項目 | 選擇 | 理由 |
|-----|------|------|
| 框架 | Angular 17+ | 團隊熟悉、完整生態系 |
| UI 框架 | Angular Material | 開箱即用、設計美觀 |
| 狀態管理 | Angular Services + RxJS | 小系統不需要 NgRx |

### 後端 (Supabase)
| 項目 | 說明 |
|-----|------|
| 資料庫 | PostgreSQL |
| 認證 | Supabase Auth (Email 登入) |
| 檔案儲存 | Supabase Storage (設備照片) |
| 通知觸發 | Database Triggers + Edge Functions |

### 部署
| 項目 | 選擇 | 費用 |
|-----|------|------|
| 前端託管 | Netlify | 免費 |
| 後端服務 | Supabase | 免費方案 |
| 通知服務 | Telegram Bot | 免費 |

---

## 使用者角色

### 管理員 (Admin)
- 新增/編輯/刪除設備
- 管理使用者帳號
- 設定 Telegram 通知
- 強制歸還設備

### 一般使用者 (User)
- 瀏覽設備列表
- 借用/歸還設備
- 查看個人借用記錄

---

## 核心功能

### 1. 使用者認證
- **開放註冊** - 使用者可在前端自行註冊帳號
- Email + 密碼登入
- 記住登入狀態
- 忘記密碼重設
- 新註冊使用者預設為一般使用者（User）角色

### 2. 設備管理
**設備資訊（精簡版）：**
- 設備名稱（如 "iPhone 15 Pro"）
- 品牌（Apple, Samsung, Google 等）
- 型號
- 作業系統與版本
- 設備照片（1 張主圖）
- 備註

**設備狀態（3 種）：**
| 狀態 | 說明 | 顏色 |
|-----|------|------|
| 可借用 | 設備閒置中 | 🟢 綠色 |
| 已借出 | 有人正在使用 | 🔴 紅色 |
| 維修中 | 暫時無法使用 | 🟡 黃色 |

### 3. 借用流程

```
┌─────────────┐     ┌─────────────┐     ┌─────────────┐
│  選擇設備   │ ──▶ │  填寫用途   │ ──▶ │  確認借用   │
│  (1 click)  │     │  (選填)     │     │  (1 click)  │
└─────────────┘     └─────────────┘     └─────────────┘
                                               │
                                               ▼
                                    ┌─────────────────┐
                                    │ 自動發送 TG 通知 │
                                    │ 設備狀態變更     │
                                    └─────────────────┘
```

### 4. 歸還流程

```
┌─────────────┐     ┌─────────────┐
│  點擊歸還   │ ──▶ │  確認歸還   │
│  (1 click)  │     │  (1 click)  │
└─────────────┘     └─────────────┘
        │
        ▼
┌─────────────────┐
│ 自動發送 TG 通知 │
│ 設備狀態變更     │
└─────────────────┘
```

### 5. Telegram 通知

**借用通知：**
```
📱 設備借用通知
━━━━━━━━━━━━━━━
設備：iPhone 15 Pro
借用者：user@example.com
時間：2026-01-14 09:00
用途：iOS App 測試

📊 目前狀態：
🟢 Samsung S24 - 可借用
🔴 iPhone 15 Pro - user@example.com
🔴 Pixel 8 - test@example.com
🟡 iPad Pro - 維修中
```

**歸還通知：**
```
✅ 設備歸還通知
━━━━━━━━━━━━━━━
設備：iPhone 15 Pro
歸還者：user@example.com
時間：2026-01-15 17:30

📊 目前狀態：
🟢 Samsung S24 - 可借用
🟢 iPhone 15 Pro - 可借用
🔴 Pixel 8 - test@example.com
🟡 iPad Pro - 維修中
```

---

## 資料庫設計（精簡版）

### ER Diagram

```
┌──────────────┐       ┌──────────────┐       ┌──────────────┐
│    users     │       │   devices    │       │   borrows    │
├──────────────┤       ├──────────────┤       ├──────────────┤
│ id (PK)      │       │ id (PK)      │       │ id (PK)      │
│ email        │◄──────│ created_by   │       │ user_id (FK) │──────►│
│ role         │       │ name         │◄──────│ device_id(FK)│
│ created_at   │       │ brand        │       │ purpose      │
└──────────────┘       │ model        │       │ borrowed_at  │
                       │ os           │       │ returned_at  │
                       │ image_url    │       │ status       │
                       │ status       │       │ created_at   │
                       │ notes        │       └──────────────┘
                       │ created_at   │
                       └──────────────┘

┌──────────────────┐
│ telegram_config  │
├──────────────────┤
│ id (PK)          │
│ bot_token        │
│ chat_id          │
│ thread_id        │
│ is_enabled       │
│ updated_at       │
└──────────────────┘
```

### 資料表說明

#### users（使用者）
| 欄位 | 類型 | 說明 |
|-----|------|------|
| id | UUID | 主鍵，對應 Supabase Auth |
| email | TEXT | 使用者信箱 |
| role | TEXT | 角色：admin / user |
| created_at | TIMESTAMP | 建立時間 |

#### devices（設備）
| 欄位 | 類型 | 說明 |
|-----|------|------|
| id | UUID | 主鍵 |
| name | TEXT | 設備名稱 |
| brand | TEXT | 品牌 |
| model | TEXT | 型號 |
| os | TEXT | 作業系統 |
| os_version | TEXT | 系統版本 |
| image_url | TEXT | 設備照片 URL |
| status | TEXT | 狀態：available / borrowed / maintenance |
| notes | TEXT | 備註 |
| created_by | UUID | 建立者 |
| created_at | TIMESTAMP | 建立時間 |

#### borrows（借用記錄）
| 欄位 | 類型 | 說明 |
|-----|------|------|
| id | UUID | 主鍵 |
| user_id | UUID | 借用者 ID |
| device_id | UUID | 設備 ID |
| purpose | TEXT | 借用用途 |
| borrowed_at | TIMESTAMP | 借用時間 |
| returned_at | TIMESTAMP | 歸還時間（null 表示未歸還） |
| status | TEXT | active / returned |
| created_at | TIMESTAMP | 建立時間 |

#### telegram_config（Telegram 設定）
| 欄位 | 類型 | 說明 |
|-----|------|------|
| id | UUID | 主鍵 |
| bot_token | TEXT | Bot Token |
| chat_id | TEXT | 群組 Chat ID |
| thread_id | TEXT | 話題 ID（可選） |
| is_enabled | BOOLEAN | 是否啟用通知 |
| updated_at | TIMESTAMP | 更新時間 |

---

## 頁面規劃

### 頁面清單

| 頁面 | 路由 | 權限 | 說明 |
|-----|------|------|------|
| 登入 | /login | 公開 | Email 登入 |
| 首頁 | / | 登入 | 設備列表 + 狀態總覽 |
| 我的借用 | /my-borrows | 登入 | 個人借用記錄 + 歸還 |
| 設備管理 | /admin/devices | Admin | 設備 CRUD |
| 使用者管理 | /admin/users | Admin | 使用者管理 |
| 系統設定 | /admin/settings | Admin | Telegram 設定 |

### 操作流程圖

**借用設備：**
```
首頁 ──▶ 點擊設備卡片 ──▶ 借用彈窗 ──▶ 填寫用途 ──▶ 確認借用 ──▶ 完成
                          (顯示設備詳情)   (選填)      (按鈕)     (自動通知)
```

**歸還設備：**
```
我的借用 ──▶ 點擊歸還按鈕 ──▶ 確認歸還 ──▶ 完成
                              (彈窗確認)   (自動通知)
```

---

## 安全性設計

### Supabase RLS 政策
- 所有使用者可讀取設備列表
- 只有本人可讀取自己的借用記錄
- 只有 Admin 可新增/編輯/刪除設備
- 只有 Admin 可管理使用者

### 認證安全
- JWT Token 認證
- Session 自動過期（7 天）
- HTTPS 強制使用

---

## 開發時程

### Phase 1：基礎建設（Week 1）
- [ ] Angular 專案初始化
- [ ] Supabase 專案設定
- [ ] 資料庫建立
- [ ] 基本 UI 框架

### Phase 2：核心功能（Week 2-3）
- [ ] 登入/登出
- [ ] 設備列表頁面
- [ ] 借用/歸還功能
- [ ] 我的借用頁面

### Phase 3：管理功能（Week 4）
- [ ] 設備管理（CRUD）
- [ ] 使用者管理
- [ ] Telegram 通知整合

### Phase 4：測試與部署（Week 5）
- [ ] 功能測試
- [ ] Netlify 部署
- [ ] 團隊試用與修正

---

## 成本評估

| 項目 | 免費方案限制 | 實際用量 | 狀態 |
|-----|------------|---------|------|
| Supabase 資料庫 | 500 MB | < 10 MB | ✅ 足夠 |
| Supabase 儲存 | 1 GB | < 50 MB | ✅ 足夠 |
| Supabase API | 50萬次/月 | < 1萬次 | ✅ 足夠 |
| Netlify 頻寬 | 100 GB/月 | < 1 GB | ✅ 足夠 |
| Telegram Bot | 無限制 | - | ✅ 免費 |

**總營運成本：$0 / 月**

---

## 相關文件

| 文件 | 說明 |
|-----|------|
| [QUICK_START.md](./QUICK_START.md) | 快速上手指南 |
| [SUPABASE_SETUP.md](./SUPABASE_SETUP.md) | Supabase 完整設定教學 |
| [UI_DESIGN.md](./UI_DESIGN.md) | UI/UX 設計規範 |
| [database.sql](./database.sql) | 資料庫 SQL 腳本 |
| [TELEGRAM_SETUP.md](./TELEGRAM_SETUP.md) | Telegram Bot 設定教學 |

---

## 成功標準

- [ ] 團隊成員可在 1 分鐘內完成借用
- [ ] Telegram 群組即時收到借用/歸還通知
- [ ] 不會發生兩人同時借用同一設備的情況
- [ ] 系統運行穩定，無需人工介入
