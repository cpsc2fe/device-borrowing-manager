import{a as _e}from"./chunk-5WIDQLZN.js";import{a as ge,b as fe}from"./chunk-JYEPO45A.js";import"./chunk-MEBUCGCQ.js";import{d as z,g as N}from"./chunk-VTKZNL4V.js";import{a as be}from"./chunk-4MNVYLOK.js";import{a as ve}from"./chunk-T55EWQTZ.js";import{a as Z,b as ee}from"./chunk-MDRIXYBX.js";import{a as xe}from"./chunk-UYPCDNCC.js";import{a as q,c as G,d as H,f as J,g as te,h as ie}from"./chunk-56Q56IV5.js";import{a as ce,b as se,c as de,d as le,e as me,f as pe,g as ue,h as S}from"./chunk-EFACFY3A.js";import{Ja as ae,Ka as re,aa as K,b as U,f as $,fa as X,ga as Y,ha as y,i as Q,ka as O,la as ne,ma as oe,p as W}from"./chunk-EWSGLXCW.js";import{$a as g,Ab as a,Bb as _,Cb as M,Eb as F,Ec as E,Fb as B,Gb as L,Ha as P,Hb as T,Ja as r,Jb as w,Ka as p,Lb as A,bb as d,db as I,ec as V,f as b,fc as R,gc as j,hb as n,ib as i,ic as D,jb as k,ka as h,nb as C,qb as u,ra as v,sa as f,sb as l}from"./chunk-R7MLKEAJ.js";var Ce=(()=>{class t{constructor(e,s,o){this.dialogRef=e,this.data=s,this.supabase=o,this.purpose="",this.userEmail="",this.userEmail=this.supabase.currentUserValue?.email||""}onConfirm(){let e={borrowerName:this.userEmail,borrowerEmail:this.userEmail,purpose:this.purpose.trim()||void 0};this.dialogRef.close(e)}static{this.\u0275fac=function(s){return new(s||t)(p(ce),p(se),p(E))}}static{this.\u0275cmp=h({type:t,selectors:[["app-borrow-dialog"]],standalone:!0,features:[w],decls:16,vars:3,consts:[["mat-dialog-title",""],[1,"borrower-info"],["appearance","outline",1,"full-width"],["matInput","","placeholder","\u4F8B\uFF1AiOS App \u6E2C\u8A66",3,"ngModelChange","ngModel"],["align","end"],["mat-button","","mat-dialog-close",""],["mat-raised-button","","color","primary",3,"click"]],template:function(s,o){s&1&&(n(0,"h2",0),a(1),i(),n(2,"mat-dialog-content")(3,"p",1),a(4," \u501F\u7528\u8005\uFF1A"),n(5,"strong"),a(6),i()(),n(7,"mat-form-field",2)(8,"mat-label"),a(9,"\u501F\u7528\u7528\u9014\uFF08\u9078\u586B\uFF09"),i(),n(10,"input",3),T("ngModelChange",function(x){return L(o.purpose,x)||(o.purpose=x),x}),i()()(),n(11,"mat-dialog-actions",4)(12,"button",5),a(13,"\u53D6\u6D88"),i(),n(14,"button",6),u("click",function(){return o.onConfirm()}),a(15," \u78BA\u8A8D\u501F\u7528 "),i()()),s&2&&(r(),M("\u501F\u7528 ",o.data.deviceName,""),r(5),_(o.userEmail),r(4),B("ngModel",o.purpose))},dependencies:[D,W,U,$,Q,S,le,me,ue,pe,Y,X,K,ee,Z,O,y],styles:["[_nghost-%COMP%]{display:block;overflow:hidden}mat-dialog-content[_ngcontent-%COMP%]{min-width:min(300px,80vw);overflow:visible}.borrower-info[_ngcontent-%COMP%]{margin:0 0 16px;padding:12px;background:var(--app-surface-hover);border-radius:8px;color:var(--app-text-muted)}.borrower-info[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{color:var(--app-text-primary)}.full-width[_ngcontent-%COMP%]{width:100%}mat-form-field[_ngcontent-%COMP%]{margin-top:4px}"]})}}return t})();var Ee=t=>["/device",t];function ye(t,m){t&1&&(n(0,"div",11),k(1,"mat-spinner",12),n(2,"span"),a(3,"\u8F09\u5165\u4E2D..."),i()())}function Oe(t,m){if(t&1){let e=C();n(0,"img",29),u("error",function(o){v(e);let c=l(3);return f(c.onImageError(o))}),i()}if(t&2){let e=l().$implicit;d("src",e.image_url,P)("alt",e.name)}}function Se(t,m){t&1&&(n(0,"div",30)(1,"mat-icon"),a(2,"phone_android"),i()())}function Pe(t,m){t&1&&(n(0,"span"),a(1,"\u53EF\u501F\u7528"),i())}function Ie(t,m){t&1&&(n(0,"span"),a(1,"\u5DF2\u501F\u51FA"),i())}function ke(t,m){t&1&&(n(0,"span"),a(1,"\u7DAD\u4FEE\u4E2D"),i())}function Fe(t,m){if(t&1&&(n(0,"div",31)(1,"mat-icon"),a(2,"person"),i(),n(3,"span"),a(4),i()()),t&2){let e=l().$implicit;r(4),_(e.borrower_name)}}function Be(t,m){if(t&1){let e=C();n(0,"button",32),u("click",function(){v(e);let o=l().$implicit,c=l(2);return f(c.borrowDevice(o))}),n(1,"mat-icon"),a(2,"download"),i(),a(3," \u501F\u7528 "),i()}if(t&2){let e=l().$implicit;d("disabled",e.processing)}}function Le(t,m){if(t&1){let e=C();n(0,"button",33),u("click",function(){v(e);let o=l().$implicit,c=l(2);return f(c.returnDevice(o))}),n(1,"mat-icon"),a(2,"upload"),i(),a(3," \u6B78\u9084 "),i()}if(t&2){let e=l().$implicit;d("disabled",e.processing)}}function Te(t,m){t&1&&(n(0,"button",34),a(1," \u7DAD\u4FEE\u4E2D "),i())}function Ae(t,m){if(t&1){let e=C();n(0,"mat-card",15)(1,"div",16),u("click",function(){let o=v(e).$implicit,c=l(2);return f(c.openImageLightbox(o))}),g(2,Oe,1,2,"img",17)(3,Se,3,0,"div",18),i(),n(4,"div",19),g(5,Pe,2,0,"span",20)(6,Ie,2,0,"span",20)(7,ke,2,0,"span",20),i(),n(8,"mat-card-content")(9,"h3",21)(10,"a",22),a(11),i()(),n(12,"p",23),a(13),i(),g(14,Fe,5,1,"div",24),i(),n(15,"mat-card-actions")(16,"button",25),u("click",function(){let o=v(e).$implicit,c=l(2);return f(c.showQrCode(o))}),n(17,"mat-icon"),a(18,"qr_code"),i(),a(19," QR "),i(),g(20,Be,4,1,"button",26)(21,Le,4,1,"button",27)(22,Te,2,0,"button",28),i()()}if(t&2){let e=m.$implicit,s=l(2);r(),I("clickable",e.image_url),r(),d("ngIf",e.image_url),r(),d("ngIf",!e.image_url),r(),d("ngClass",e.status),r(),d("ngIf",e.status==="available"),r(),d("ngIf",e.status==="borrowed"),r(),d("ngIf",e.status==="maintenance"),r(3),d("routerLink",A(17,Ee,e.id)),r(),M(" ",e.name," "),r(2),F("",e.brand," \xB7 ",e.os," ",e.os_version,""),r(),d("ngIf",e.status==="borrowed"&&e.borrower_name),r(6),d("ngIf",e.status==="available"),r(),d("ngIf",e.status==="borrowed"&&e.borrower_email===s.currentUserEmail),r(),d("ngIf",e.status==="maintenance")}}function Ve(t,m){if(t&1&&(n(0,"div",13),g(1,Ae,23,19,"mat-card",14),i()),t&2){let e=l();r(),d("ngForOf",e.devices)}}function Re(t,m){t&1&&(n(0,"div",35)(1,"mat-icon"),a(2,"devices"),i(),n(3,"p"),a(4,"\u76EE\u524D\u6C92\u6709\u4EFB\u4F55\u8A2D\u5099"),i()())}var vt=(()=>{class t{constructor(e,s,o,c,x){this.deviceService=e,this.borrowService=s,this.supabase=o,this.dialog=c,this.snackBar=x,this.devices=[],this.stats={total:0,available:0,borrowed:0,maintenance:0},this.loading=!0,this.currentUserEmail="",this.currentUserEmail=this.supabase.currentUserValue?.email||""}ngOnInit(){return b(this,null,function*(){yield this.loadDevices()})}loadDevices(){return b(this,null,function*(){this.loading=!0;try{this.devices=yield this.deviceService.getDevices(),this.stats=yield this.deviceService.getStats()}catch(e){console.error("Error loading devices:",e),this.snackBar.open("\u8F09\u5165\u8A2D\u5099\u5931\u6557","\u95DC\u9589",{duration:3e3})}finally{this.loading=!1}})}showQrCode(e){this.dialog.open(be,{width:"350px",data:{deviceId:e.id,deviceName:e.name}})}openImageLightbox(e){e.image_url&&this.dialog.open(_e,{data:{imageUrl:e.image_url,title:e.name}})}onImageError(e){e.target.style.display="none"}borrowDevice(e){this.dialog.open(Ce,{width:"350px",data:{deviceName:e.name}}).afterClosed().subscribe(o=>b(this,null,function*(){if(o){e.processing=!0;try{let c=yield this.borrowService.borrowDevice(e.id,o.borrowerName,o.borrowerEmail,o.purpose);c.success?this.snackBar.open("\u501F\u7528\u6210\u529F\uFF01","\u95DC\u9589",{duration:3e3}):this.snackBar.open(c.error||"\u501F\u7528\u5931\u6557","\u95DC\u9589",{duration:5e3}),yield this.loadDevices()}catch(c){console.error("Borrow error:",c),this.snackBar.open(c.message||"\u501F\u7528\u5931\u6557","\u95DC\u9589",{duration:5e3}),yield this.loadDevices()}finally{e.processing=!1}}}))}returnDevice(e){this.dialog.open(ge,{width:"400px",data:{deviceName:e.name}}).afterClosed().subscribe(o=>b(this,null,function*(){if(o&&e.active_borrow_id){e.processing=!0;try{let c=yield this.borrowService.returnDevice(e.active_borrow_id);c.success?this.snackBar.open("\u6B78\u9084\u6210\u529F\uFF01","\u95DC\u9589",{duration:3e3}):this.snackBar.open(c.error||"\u6B78\u9084\u5931\u6557","\u95DC\u9589",{duration:5e3}),yield this.loadDevices()}catch(c){console.error("Return error:",c),this.snackBar.open(c.message||"\u6B78\u9084\u5931\u6557","\u95DC\u9589",{duration:5e3}),yield this.loadDevices()}finally{e.processing=!1}}}))}static{this.\u0275fac=function(s){return new(s||t)(p(ve),p(fe),p(E),p(de),p(ae))}}static{this.\u0275cmp=h({type:t,selectors:[["app-device-list"]],standalone:!0,features:[w],decls:25,vars:6,consts:[[1,"device-list-container"],[1,"info-banner"],[1,"stats-row"],[1,"stat-card"],[1,"stat-number"],[1,"stat-label"],[1,"stat-card","available"],[1,"stat-card","borrowed"],["class","loading",4,"ngIf"],["class","device-grid",4,"ngIf"],["class","empty-state",4,"ngIf"],[1,"loading"],["diameter","40"],[1,"device-grid"],["class","device-card",4,"ngFor","ngForOf"],[1,"device-card"],[1,"device-image",3,"click"],[3,"src","alt","error",4,"ngIf"],["class","no-image",4,"ngIf"],[1,"status-badge",3,"ngClass"],[4,"ngIf"],[1,"device-name"],[1,"device-name-link",3,"routerLink"],[1,"device-info"],["class","borrower-info",4,"ngIf"],["mat-stroked-button","",3,"click"],["mat-flat-button","","color","primary",3,"disabled","click",4,"ngIf"],["mat-flat-button","","color","warn",3,"disabled","click",4,"ngIf"],["mat-stroked-button","","color","warn","disabled","",4,"ngIf"],[3,"error","src","alt"],[1,"no-image"],[1,"borrower-info"],["mat-flat-button","","color","primary",3,"click","disabled"],["mat-flat-button","","color","warn",3,"click","disabled"],["mat-stroked-button","","color","warn","disabled",""],[1,"empty-state"]],template:function(s,o){s&1&&(n(0,"div",0)(1,"div",1)(2,"mat-icon"),a(3,"qr_code_scanner"),i(),n(4,"span"),a(5,"\u6383\u63CF\u8A2D\u5099\u4E0A\u7684 QR Code \u5373\u53EF\u501F\u7528\u6216\u6B78\u9084"),i()(),n(6,"div",2)(7,"div",3)(8,"div",4),a(9),i(),n(10,"div",5),a(11,"\u7E3D\u8A2D\u5099"),i()(),n(12,"div",6)(13,"div",4),a(14),i(),n(15,"div",5),a(16,"\u53EF\u501F\u7528"),i()(),n(17,"div",7)(18,"div",4),a(19),i(),n(20,"div",5),a(21,"\u5DF2\u501F\u51FA"),i()()(),g(22,ye,4,0,"div",8)(23,Ve,2,1,"div",9)(24,Re,5,0,"div",10),i()),s&2&&(r(9),_(o.stats.total),r(5),_(o.stats.available),r(5),_(o.stats.borrowed),r(3),d("ngIf",o.loading),r(),d("ngIf",!o.loading),r(),d("ngIf",!o.loading&&o.devices.length===0))},dependencies:[D,V,R,j,N,z,J,q,H,G,O,y,oe,ne,xe,ie,te,S,re],styles:[".device-list-container[_ngcontent-%COMP%]{max-width:1200px;margin:0 auto}.info-banner[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;padding:12px 16px;background:transparent;border:1px solid rgba(227,229,232,.6);border-radius:3px;margin-bottom:16px;color:#e3e5e8d9}.info-banner[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:20px;width:20px;height:20px}.stats-row[_ngcontent-%COMP%]{display:flex;gap:16px;margin-bottom:24px}.stat-card[_ngcontent-%COMP%]{flex:1;background:var(--app-surface);border-radius:3px;padding:16px;text-align:center;box-shadow:0 2px 8px #00000059}.stat-number[_ngcontent-%COMP%]{font-size:32px;font-weight:500;color:var(--app-text)}.stat-label[_ngcontent-%COMP%]{font-size:14px;color:var(--app-text-muted)}.stat-card.available[_ngcontent-%COMP%]   .stat-number[_ngcontent-%COMP%]{color:var(--app-success)}.stat-card.borrowed[_ngcontent-%COMP%]   .stat-number[_ngcontent-%COMP%]{color:var(--app-danger)}.loading[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;gap:16px;padding:48px;color:var(--app-text-muted)}.device-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:16px}.device-card[_ngcontent-%COMP%]{display:flex;flex-direction:column;border-radius:3px;overflow:hidden;background:var(--app-surface)}.device-image[_ngcontent-%COMP%]{width:100%;height:180px;background:var(--app-surface-elev);display:flex;align-items:center;justify-content:center;overflow:hidden;cursor:pointer}.device-image[_ngcontent-%COMP%]:hover{opacity:.9}.device-image.clickable[_ngcontent-%COMP%]{cursor:zoom-in}.device-image[_ngcontent-%COMP%]:not(.clickable){cursor:default}.device-image[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:100%;object-fit:cover;object-position:top center}.no-image[_ngcontent-%COMP%]{color:var(--app-text-muted)}.no-image[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:64px;width:64px;height:64px}.status-badge[_ngcontent-%COMP%]{display:inline-block;padding:4px 12px;border-radius:3px;font-size:12px;font-weight:500;margin:12px 16px 0;width:fit-content}.status-badge.available[_ngcontent-%COMP%]{background:var(--app-success-bg);color:var(--app-success)}.status-badge.borrowed[_ngcontent-%COMP%]{background:var(--app-danger-bg);color:var(--app-danger)}.status-badge.maintenance[_ngcontent-%COMP%]{background:var(--app-warning-bg);color:var(--app-warning)}mat-card-content[_ngcontent-%COMP%]{flex:1;padding:16px!important}.device-name[_ngcontent-%COMP%]{margin:0 0 4px;font-size:18px;font-weight:500}.device-name-link[_ngcontent-%COMP%]{color:inherit;text-decoration:none}.device-name-link[_ngcontent-%COMP%]:hover{text-decoration:underline}.device-info[_ngcontent-%COMP%]{margin:0;font-size:14px;color:var(--app-text-muted)}.borrower-info[_ngcontent-%COMP%]{display:flex;align-items:center;gap:4px;margin-top:8px;font-size:12px;color:var(--app-text-muted)}.borrower-info[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:16px;width:16px;height:16px}mat-card-actions[_ngcontent-%COMP%]{padding:8px 16px 16px!important;display:flex;gap:8px}mat-card-actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{flex:1}mat-card-actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{margin-right:4px}.empty-state[_ngcontent-%COMP%]{text-align:center;padding:48px;color:var(--app-text-muted)}.empty-state[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:64px;width:64px;height:64px;margin-bottom:16px}@media (max-width: 600px){.stats-row[_ngcontent-%COMP%]{flex-wrap:wrap}.stat-card[_ngcontent-%COMP%]{min-width:calc(50% - 8px)}.device-grid[_ngcontent-%COMP%]{grid-template-columns:1fr}}"]})}}return t})();export{vt as DeviceListComponent};
