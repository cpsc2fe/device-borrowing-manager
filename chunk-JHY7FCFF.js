import{a as ge,b as _e,c as fe}from"./chunk-GQFLH3PL.js";import"./chunk-3FIYCOO5.js";import{d as z,g as j}from"./chunk-I6XOOWNW.js";import{a as be}from"./chunk-HWNOYATN.js";import{a as ve}from"./chunk-C2Q4BQS5.js";import{a as xe}from"./chunk-WNIR6GMR.js";import{a as ce,b as se,c as de,d as le,e as me,f as pe,g as ue,h as y}from"./chunk-SRPUPYMG.js";import{a as q,c as G,d as H,f as J,g as K,k as X,l as Y,m as Z,n as ee,o as te,p as ie,q as ae,r as re}from"./chunk-ZVD7ITEB.js";import{b as $,ba as D,da as E,ea as ne,f as Q,fa as oe,i as U,o as W}from"./chunk-UEBNNHWR.js";import{$a as g,Ab as a,Bb as _,Cb as M,Eb as k,Ec as N,Fb as F,Gb as B,Ha as P,Hb as L,Ja as r,Jb as h,Ka as p,Lb as T,bb as d,db as S,ec as A,f as x,fc as V,gc as R,hb as n,ib as i,ic as w,jb as I,ka as C,nb as b,qb as u,ra as v,sa as f,sb as m}from"./chunk-YVT4I57R.js";var Ce=(()=>{class t{constructor(e,s,o){this.dialogRef=e,this.data=s,this.supabase=o,this.purpose="",this.userEmail="",this.userEmail=this.supabase.currentUserValue?.email||""}onConfirm(){let e={borrowerName:this.userEmail,borrowerEmail:this.userEmail,purpose:this.purpose.trim()||void 0};this.dialogRef.close(e)}static{this.\u0275fac=function(s){return new(s||t)(p(ce),p(se),p(N))}}static{this.\u0275cmp=C({type:t,selectors:[["app-borrow-dialog"]],standalone:!0,features:[h],decls:16,vars:3,consts:[["mat-dialog-title",""],[1,"borrower-info"],["appearance","outline",1,"full-width"],["matInput","","placeholder","\u4F8B\uFF1AiOS App \u6E2C\u8A66",3,"ngModelChange","ngModel"],["align","end"],["mat-button","","mat-dialog-close",""],["mat-raised-button","","color","primary",3,"click"]],template:function(s,o){s&1&&(n(0,"h2",0),a(1),i(),n(2,"mat-dialog-content")(3,"p",1),a(4," \u501F\u7528\u8005\uFF1A"),n(5,"strong"),a(6),i()(),n(7,"mat-form-field",2)(8,"mat-label"),a(9,"\u501F\u7528\u7528\u9014\uFF08\u9078\u586B\uFF09"),i(),n(10,"input",3),L("ngModelChange",function(O){return B(o.purpose,O)||(o.purpose=O),O}),i()()(),n(11,"mat-dialog-actions",4)(12,"button",5),a(13,"\u53D6\u6D88"),i(),n(14,"button",6),u("click",function(){return o.onConfirm()}),a(15," \u78BA\u8A8D\u501F\u7528 "),i()()),s&2&&(r(),M("\u501F\u7528 ",o.data.deviceName,""),r(5),_(o.userEmail),r(4),F("ngModel",o.purpose))},dependencies:[w,W,$,Q,U,y,le,me,ue,pe,Y,X,K,ee,Z,E,D],styles:["[_nghost-%COMP%]{display:block;overflow:hidden}mat-dialog-content[_ngcontent-%COMP%]{min-width:min(300px,80vw);overflow:visible}.borrower-info[_ngcontent-%COMP%]{margin:0 0 16px;padding:12px;background:var(--app-surface-hover);border-radius:8px;color:var(--app-text-muted)}.borrower-info[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{color:var(--app-text-primary)}.full-width[_ngcontent-%COMP%]{width:100%}mat-form-field[_ngcontent-%COMP%]{margin-top:4px}"]})}}return t})();var De=t=>["/device",t];function Ee(t,l){t&1&&(n(0,"div",11),I(1,"mat-spinner",12),n(2,"span"),a(3,"\u8F09\u5165\u4E2D..."),i()())}function ye(t,l){if(t&1){let e=b();n(0,"img",29),u("error",function(o){v(e);let c=m(3);return f(c.onImageError(o))}),i()}if(t&2){let e=m().$implicit;d("src",e.image_url,P)("alt",e.name)}}function Oe(t,l){t&1&&(n(0,"div",30)(1,"mat-icon"),a(2,"phone_android"),i()())}function Pe(t,l){t&1&&(n(0,"span"),a(1,"\u53EF\u501F\u7528"),i())}function Se(t,l){t&1&&(n(0,"span"),a(1,"\u5DF2\u501F\u51FA"),i())}function Ie(t,l){t&1&&(n(0,"span"),a(1,"\u7DAD\u4FEE\u4E2D"),i())}function ke(t,l){if(t&1&&(n(0,"div",31)(1,"mat-icon"),a(2,"person"),i(),n(3,"span"),a(4),i()()),t&2){let e=m().$implicit;r(4),_(e.borrower_name)}}function Fe(t,l){if(t&1){let e=b();n(0,"button",32),u("click",function(){v(e);let o=m().$implicit,c=m(2);return f(c.borrowDevice(o))}),n(1,"mat-icon"),a(2,"download"),i(),a(3," \u501F\u7528 "),i()}if(t&2){let e=m().$implicit;d("disabled",e.processing)}}function Be(t,l){if(t&1){let e=b();n(0,"button",33),u("click",function(){v(e);let o=m().$implicit,c=m(2);return f(c.returnDevice(o))}),n(1,"mat-icon"),a(2,"upload"),i(),a(3," \u6B78\u9084 "),i()}if(t&2){let e=m().$implicit;d("disabled",e.processing)}}function Le(t,l){t&1&&(n(0,"button",34),a(1," \u7DAD\u4FEE\u4E2D "),i())}function Te(t,l){if(t&1){let e=b();n(0,"mat-card",15)(1,"div",16),u("click",function(){let o=v(e).$implicit,c=m(2);return f(c.openImageLightbox(o))}),g(2,ye,1,2,"img",17)(3,Oe,3,0,"div",18),i(),n(4,"div",19),g(5,Pe,2,0,"span",20)(6,Se,2,0,"span",20)(7,Ie,2,0,"span",20),i(),n(8,"mat-card-content")(9,"h3",21)(10,"a",22),a(11),i()(),n(12,"p",23),a(13),i(),g(14,ke,5,1,"div",24),i(),n(15,"mat-card-actions")(16,"button",25),u("click",function(){let o=v(e).$implicit,c=m(2);return f(c.showQrCode(o))}),n(17,"mat-icon"),a(18,"qr_code"),i(),a(19," QR "),i(),g(20,Fe,4,1,"button",26)(21,Be,4,1,"button",27)(22,Le,2,0,"button",28),i()()}if(t&2){let e=l.$implicit;r(),S("clickable",e.image_url),r(),d("ngIf",e.image_url),r(),d("ngIf",!e.image_url),r(),d("ngClass",e.status),r(),d("ngIf",e.status==="available"),r(),d("ngIf",e.status==="borrowed"),r(),d("ngIf",e.status==="maintenance"),r(3),d("routerLink",T(17,De,e.id)),r(),M(" ",e.name," "),r(2),k("",e.brand," \xB7 ",e.os," ",e.os_version,""),r(),d("ngIf",e.status==="borrowed"&&e.borrower_name),r(6),d("ngIf",e.status==="available"),r(),d("ngIf",e.status==="borrowed"),r(),d("ngIf",e.status==="maintenance")}}function Ae(t,l){if(t&1&&(n(0,"div",13),g(1,Te,23,19,"mat-card",14),i()),t&2){let e=m();r(),d("ngForOf",e.devices)}}function Ve(t,l){t&1&&(n(0,"div",35)(1,"mat-icon"),a(2,"devices"),i(),n(3,"p"),a(4,"\u76EE\u524D\u6C92\u6709\u4EFB\u4F55\u8A2D\u5099"),i()())}var vt=(()=>{class t{constructor(e,s,o,c){this.deviceService=e,this.borrowService=s,this.dialog=o,this.snackBar=c,this.devices=[],this.stats={total:0,available:0,borrowed:0,maintenance:0},this.loading=!0}ngOnInit(){return x(this,null,function*(){yield this.loadDevices()})}loadDevices(){return x(this,null,function*(){this.loading=!0;try{this.devices=yield this.deviceService.getDevices(),this.stats=yield this.deviceService.getStats()}catch(e){console.error("Error loading devices:",e),this.snackBar.open("\u8F09\u5165\u8A2D\u5099\u5931\u6557","\u95DC\u9589",{duration:3e3})}finally{this.loading=!1}})}showQrCode(e){this.dialog.open(be,{width:"350px",data:{deviceId:e.id,deviceName:e.name}})}openImageLightbox(e){e.image_url&&this.dialog.open(_e,{data:{imageUrl:e.image_url,title:e.name}})}onImageError(e){e.target.style.display="none"}borrowDevice(e){this.dialog.open(Ce,{width:"350px",data:{deviceName:e.name}}).afterClosed().subscribe(o=>x(this,null,function*(){if(o){e.processing=!0;try{let c=yield this.borrowService.borrowDevice(e.id,o.borrowerName,o.borrowerEmail,o.purpose);c.success?this.snackBar.open("\u501F\u7528\u6210\u529F\uFF01","\u95DC\u9589",{duration:3e3}):this.snackBar.open(c.error||"\u501F\u7528\u5931\u6557","\u95DC\u9589",{duration:5e3}),yield this.loadDevices()}catch(c){console.error("Borrow error:",c),this.snackBar.open(c.message||"\u501F\u7528\u5931\u6557","\u95DC\u9589",{duration:5e3}),yield this.loadDevices()}finally{e.processing=!1}}}))}returnDevice(e){this.dialog.open(ge,{width:"400px",data:{deviceName:e.name}}).afterClosed().subscribe(o=>x(this,null,function*(){if(o&&e.active_borrow_id){e.processing=!0;try{let c=yield this.borrowService.returnDevice(e.active_borrow_id);c.success?this.snackBar.open("\u6B78\u9084\u6210\u529F\uFF01","\u95DC\u9589",{duration:3e3}):this.snackBar.open(c.error||"\u6B78\u9084\u5931\u6557","\u95DC\u9589",{duration:5e3}),yield this.loadDevices()}catch(c){console.error("Return error:",c),this.snackBar.open(c.message||"\u6B78\u9084\u5931\u6557","\u95DC\u9589",{duration:5e3}),yield this.loadDevices()}finally{e.processing=!1}}}))}static{this.\u0275fac=function(s){return new(s||t)(p(ve),p(fe),p(de),p(ae))}}static{this.\u0275cmp=C({type:t,selectors:[["app-device-list"]],standalone:!0,features:[h],decls:25,vars:6,consts:[[1,"device-list-container"],[1,"info-banner"],[1,"stats-row"],[1,"stat-card"],[1,"stat-number"],[1,"stat-label"],[1,"stat-card","available"],[1,"stat-card","borrowed"],["class","loading",4,"ngIf"],["class","device-grid",4,"ngIf"],["class","empty-state",4,"ngIf"],[1,"loading"],["diameter","40"],[1,"device-grid"],["class","device-card",4,"ngFor","ngForOf"],[1,"device-card"],[1,"device-image",3,"click"],[3,"src","alt","error",4,"ngIf"],["class","no-image",4,"ngIf"],[1,"status-badge",3,"ngClass"],[4,"ngIf"],[1,"device-name"],[1,"device-name-link",3,"routerLink"],[1,"device-info"],["class","borrower-info",4,"ngIf"],["mat-stroked-button","",3,"click"],["mat-flat-button","","color","primary",3,"disabled","click",4,"ngIf"],["mat-flat-button","","color","warn",3,"disabled","click",4,"ngIf"],["mat-stroked-button","","color","warn","disabled","",4,"ngIf"],[3,"error","src","alt"],[1,"no-image"],[1,"borrower-info"],["mat-flat-button","","color","primary",3,"click","disabled"],["mat-flat-button","","color","warn",3,"click","disabled"],["mat-stroked-button","","color","warn","disabled",""],[1,"empty-state"]],template:function(s,o){s&1&&(n(0,"div",0)(1,"div",1)(2,"mat-icon"),a(3,"qr_code_scanner"),i(),n(4,"span"),a(5,"\u6383\u63CF\u8A2D\u5099\u4E0A\u7684 QR Code \u5373\u53EF\u501F\u7528\u6216\u6B78\u9084"),i()(),n(6,"div",2)(7,"div",3)(8,"div",4),a(9),i(),n(10,"div",5),a(11,"\u7E3D\u8A2D\u5099"),i()(),n(12,"div",6)(13,"div",4),a(14),i(),n(15,"div",5),a(16,"\u53EF\u501F\u7528"),i()(),n(17,"div",7)(18,"div",4),a(19),i(),n(20,"div",5),a(21,"\u5DF2\u501F\u51FA"),i()()(),g(22,Ee,4,0,"div",8)(23,Ae,2,1,"div",9)(24,Ve,5,0,"div",10),i()),s&2&&(r(9),_(o.stats.total),r(5),_(o.stats.available),r(5),_(o.stats.borrowed),r(3),d("ngIf",o.loading),r(),d("ngIf",!o.loading),r(),d("ngIf",!o.loading&&o.devices.length===0))},dependencies:[w,A,V,R,j,z,J,q,H,G,E,D,oe,ne,xe,ie,te,y,re],styles:[".device-list-container[_ngcontent-%COMP%]{max-width:1200px;margin:0 auto}.info-banner[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;padding:12px 16px;background:transparent;border:1px solid rgba(227,229,232,.6);border-radius:3px;margin-bottom:16px;color:#e3e5e8d9}.info-banner[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:20px;width:20px;height:20px}.stats-row[_ngcontent-%COMP%]{display:flex;gap:16px;margin-bottom:24px}.stat-card[_ngcontent-%COMP%]{flex:1;background:var(--app-surface);border-radius:3px;padding:16px;text-align:center;box-shadow:0 2px 8px #00000059}.stat-number[_ngcontent-%COMP%]{font-size:32px;font-weight:500;color:var(--app-text)}.stat-label[_ngcontent-%COMP%]{font-size:14px;color:var(--app-text-muted)}.stat-card.available[_ngcontent-%COMP%]   .stat-number[_ngcontent-%COMP%]{color:var(--app-success)}.stat-card.borrowed[_ngcontent-%COMP%]   .stat-number[_ngcontent-%COMP%]{color:var(--app-danger)}.loading[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;gap:16px;padding:48px;color:var(--app-text-muted)}.device-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:16px}.device-card[_ngcontent-%COMP%]{display:flex;flex-direction:column;border-radius:3px;overflow:hidden;background:var(--app-surface)}.device-image[_ngcontent-%COMP%]{width:100%;height:180px;background:var(--app-surface-elev);display:flex;align-items:center;justify-content:center;overflow:hidden;cursor:pointer}.device-image[_ngcontent-%COMP%]:hover{opacity:.9}.device-image.clickable[_ngcontent-%COMP%]{cursor:zoom-in}.device-image[_ngcontent-%COMP%]:not(.clickable){cursor:default}.device-image[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:100%;object-fit:cover;object-position:top center}.no-image[_ngcontent-%COMP%]{color:var(--app-text-muted)}.no-image[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:64px;width:64px;height:64px}.status-badge[_ngcontent-%COMP%]{display:inline-block;padding:4px 12px;border-radius:3px;font-size:12px;font-weight:500;margin:12px 16px 0;width:fit-content}.status-badge.available[_ngcontent-%COMP%]{background:var(--app-success-bg);color:var(--app-success)}.status-badge.borrowed[_ngcontent-%COMP%]{background:var(--app-danger-bg);color:var(--app-danger)}.status-badge.maintenance[_ngcontent-%COMP%]{background:var(--app-warning-bg);color:var(--app-warning)}mat-card-content[_ngcontent-%COMP%]{flex:1;padding:16px!important}.device-name[_ngcontent-%COMP%]{margin:0 0 4px;font-size:18px;font-weight:500}.device-name-link[_ngcontent-%COMP%]{color:inherit;text-decoration:none}.device-name-link[_ngcontent-%COMP%]:hover{text-decoration:underline}.device-info[_ngcontent-%COMP%]{margin:0;font-size:14px;color:var(--app-text-muted)}.borrower-info[_ngcontent-%COMP%]{display:flex;align-items:center;gap:4px;margin-top:8px;font-size:12px;color:var(--app-text-muted)}.borrower-info[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:16px;width:16px;height:16px}mat-card-actions[_ngcontent-%COMP%]{padding:8px 16px 16px!important;display:flex;gap:8px}mat-card-actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{flex:1}mat-card-actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{margin-right:4px}.empty-state[_ngcontent-%COMP%]{text-align:center;padding:48px;color:var(--app-text-muted)}.empty-state[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:64px;width:64px;height:64px;margin-bottom:16px}@media (max-width: 600px){.stats-row[_ngcontent-%COMP%]{flex-wrap:wrap}.stat-card[_ngcontent-%COMP%]{min-width:calc(50% - 8px)}.device-grid[_ngcontent-%COMP%]{grid-template-columns:1fr}}"]})}}return t})();export{vt as DeviceListComponent};
