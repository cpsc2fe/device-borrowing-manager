import{a as ce,b as pe}from"./chunk-5ZOMADD3.js";import{a as T,c as B,d as A,g as V}from"./chunk-PAKVZ7YK.js";import{c as oe,h as re,i as ae,j as de}from"./chunk-HBF5AA77.js";import{a as W,c as R,d as U,f as q,g as Q,k as X,l as Y,m as Z,n as $,o as ee,p as te,q as ie,r as ne}from"./chunk-IULNBF3J.js";import{b as z,ba as G,da as H,ea as J,f as L,fa as K,i as N,o as j}from"./chunk-O6CXBG2O.js";import{$a as l,Ab as c,Bb as b,Cb as x,Db as S,Fb as w,Gb as M,Ha as D,Hb as P,Ja as i,Jb as O,Ka as v,bb as a,db as I,eb as E,f as _,gc as k,hb as o,ib as n,ic as F,jb as f,ka as y,nb as h,qb as C,ra as g,sa as u,sb as s}from"./chunk-RS4Y4S6U.js";function me(t,d){t&1&&(o(0,"div",4),f(1,"mat-spinner",5),o(2,"span"),c(3,"\u8F09\u5165\u4E2D..."),n()())}function ge(t,d){if(t&1&&(o(0,"div",6)(1,"mat-icon"),c(2,"error_outline"),n(),o(3,"p"),c(4),n()()),t&2){let e=s();i(4),b(e.error)}}function ue(t,d){if(t&1&&f(0,"img",24),t&2){let e=s(2);a("src",e.device.image_url,D)("alt",e.device.name)}}function ve(t,d){t&1&&(o(0,"div",25)(1,"mat-icon"),c(2,"smartphone"),n()())}function _e(t,d){if(t&1&&(o(0,"span"),c(1),n()),t&2){let e=s(2);i(),x(" \xB7 ",e.device.model,"")}}function fe(t,d){if(t&1&&(o(0,"p",26),c(1),n()),t&2){let e=s(2);i(),S(" ",e.device.os," ",e.device.os_version," ")}}function xe(t,d){if(t&1&&(o(0,"p",27),c(1),n()),t&2){let e=s(2);i(),b(e.device.notes)}}function he(t,d){t&1&&(o(0,"span"),c(1,"\u53EF\u501F\u7528"),n())}function Ce(t,d){t&1&&(o(0,"span"),c(1,"\u501F\u7528\u4E2D"),n())}function be(t,d){t&1&&(o(0,"span"),c(1,"\u7DAD\u4FEE\u4E2D"),n())}function we(t,d){if(t&1&&(o(0,"p",30),c(1),n()),t&2){let e=s(3);i(),x(" \u501F\u7528\u6642\u9593\uFF1A",e.formatDate(e.device.borrowed_at)," ")}}function Me(t,d){if(t&1&&(o(0,"div",28)(1,"p"),c(2),n(),l(3,we,2,1,"p",29),n()),t&2){let e=s(2);i(2),x("\u501F\u7528\u8005\uFF1A",e.device.borrower_name,""),i(),a("ngIf",e.device.borrowed_at)}}function Pe(t,d){t&1&&f(0,"mat-spinner",38)}function ye(t,d){t&1&&(o(0,"span"),c(1,"\u501F\u7528\u6B64\u8A2D\u5099"),n())}function De(t,d){if(t&1){let e=h();o(0,"div",31)(1,"mat-form-field",32)(2,"mat-label"),c(3,"\u4F60\u7684\u540D\u5B57"),n(),o(4,"input",33),P("ngModelChange",function(r){g(e);let m=s(2);return M(m.borrowerName,r)||(m.borrowerName=r),u(r)}),n()(),o(5,"mat-form-field",32)(6,"mat-label"),c(7,"Email\uFF08\u9078\u586B\uFF09"),n(),o(8,"input",34),P("ngModelChange",function(r){g(e);let m=s(2);return M(m.borrowerEmail,r)||(m.borrowerEmail=r),u(r)}),n()(),o(9,"mat-form-field",32)(10,"mat-label"),c(11,"\u501F\u7528\u7528\u9014\uFF08\u9078\u586B\uFF09"),n(),o(12,"input",35),P("ngModelChange",function(r){g(e);let m=s(2);return M(m.purpose,r)||(m.purpose=r),u(r)}),n()(),o(13,"button",36),C("click",function(){g(e);let r=s(2);return u(r.borrowDevice())}),l(14,Pe,1,0,"mat-spinner",37)(15,ye,2,0,"span",15),n()()}if(t&2){let e=s(2);i(4),w("ngModel",e.borrowerName),a("disabled",e.processing),i(4),w("ngModel",e.borrowerEmail),a("disabled",e.processing),i(4),w("ngModel",e.purpose),a("disabled",e.processing),i(),a("disabled",e.processing||!e.borrowerName.trim()),i(),a("ngIf",e.processing),i(),a("ngIf",!e.processing)}}function Ie(t,d){t&1&&f(0,"mat-spinner",38)}function Ee(t,d){t&1&&(o(0,"span"),c(1,"\u6B78\u9084\u6B64\u8A2D\u5099"),n())}function Se(t,d){if(t&1){let e=h();o(0,"div",39)(1,"button",40),C("click",function(){g(e);let r=s(2);return u(r.returnDevice())}),l(2,Ie,1,0,"mat-spinner",37)(3,Ee,2,0,"span",15),n()()}if(t&2){let e=s(2);i(),a("disabled",e.processing),i(),a("ngIf",e.processing),i(),a("ngIf",!e.processing)}}function Oe(t,d){t&1&&(o(0,"div",41)(1,"mat-icon"),c(2,"build"),n(),o(3,"p"),c(4,"\u6B64\u8A2D\u5099\u76EE\u524D\u7DAD\u4FEE\u4E2D\uFF0C\u66AB\u6642\u7121\u6CD5\u501F\u7528"),n()())}function ke(t,d){if(t&1){let e=h();o(0,"div",7)(1,"a",8)(2,"mat-icon"),c(3,"arrow_back"),n(),c(4," \u8FD4\u56DE\u8A2D\u5099\u5217\u8868 "),n(),o(5,"mat-card",9)(6,"div",10),C("click",function(){g(e);let r=s();return u(r.openImageLightbox(r.device))}),l(7,ue,1,2,"img",11)(8,ve,3,0,"div",12),n(),o(9,"mat-card-content")(10,"h1",13),c(11),n(),o(12,"p",14),c(13),l(14,_e,2,1,"span",15),n(),l(15,fe,2,2,"p",16)(16,xe,2,1,"p",17),o(17,"div",18)(18,"div",19),l(19,he,2,0,"span",15)(20,Ce,2,0,"span",15)(21,be,2,0,"span",15),n(),l(22,Me,4,2,"div",20),n()(),o(23,"mat-card-actions"),l(24,De,16,9,"div",21)(25,Se,4,3,"div",22)(26,Oe,5,0,"div",23),n()()()}if(t&2){let e=s();i(6),I("clickable",e.device.image_url),i(),a("ngIf",e.device.image_url),i(),a("ngIf",!e.device.image_url),i(3),b(e.device.name),i(2),x(" ",e.device.brand," "),i(),a("ngIf",e.device.model),i(),a("ngIf",e.device.os),i(),a("ngIf",e.device.notes),i(2),E(e.device.status),i(),a("ngIf",e.device.status==="available"),i(),a("ngIf",e.device.status==="borrowed"),i(),a("ngIf",e.device.status==="maintenance"),i(),a("ngIf",e.device.status==="borrowed"&&e.device.borrower_name),i(2),a("ngIf",e.device.status==="available"),i(),a("ngIf",e.device.status==="borrowed"),i(),a("ngIf",e.device.status==="maintenance")}}var rt=(()=>{class t{constructor(e,p,r,m,se,le){this.route=e,this.deviceService=p,this.borrowService=r,this.snackBar=m,this.dialog=se,this.router=le,this.device=null,this.loading=!0,this.error=null,this.processing=!1,this.borrowerName="",this.borrowerEmail="",this.purpose=""}ngOnInit(){let e=this.route.snapshot.paramMap.get("id");e?this.loadDevice(e):(this.error="\u7121\u6548\u7684\u8A2D\u5099\u9023\u7D50",this.loading=!1)}loadDevice(e){return _(this,null,function*(){this.loading=!0,this.error=null;try{this.device=yield this.deviceService.getDevice(e),this.device||(this.error="\u627E\u4E0D\u5230\u6B64\u8A2D\u5099")}catch(p){console.error("Load device error:",p),this.error="\u8F09\u5165\u8A2D\u5099\u8CC7\u8A0A\u5931\u6557"}finally{this.loading=!1}})}borrowDevice(){return _(this,null,function*(){if(!(!this.device||!this.borrowerName.trim())){this.processing=!0;try{let e=yield this.borrowService.borrowDevice(this.device.id,this.borrowerName.trim(),this.borrowerEmail.trim()||void 0,this.purpose.trim()||void 0);e.success?(this.snackBar.open("\u501F\u7528\u6210\u529F\uFF01","\u95DC\u9589",{duration:3e3}),yield this.loadDevice(this.device.id),this.borrowerName="",this.borrowerEmail="",this.purpose=""):this.snackBar.open(e.error||"\u501F\u7528\u5931\u6557","\u95DC\u9589",{duration:5e3})}catch(e){console.error("Borrow error:",e),this.snackBar.open(e.message||"\u501F\u7528\u5931\u6557","\u95DC\u9589",{duration:5e3})}finally{this.processing=!1}}})}returnDevice(){return _(this,null,function*(){if(!this.device||!this.device.active_borrow_id)return;this.dialog.open(ae,{width:"320px",data:{title:"\u78BA\u8A8D\u6B78\u9084",message:`\u78BA\u5B9A\u8981\u6B78\u9084\u300C${this.device.name}\u300D\u55CE\uFF1F`,confirmText:"\u78BA\u8A8D\u6B78\u9084",cancelText:"\u53D6\u6D88"}}).afterClosed().subscribe(p=>_(this,null,function*(){if(p&&this.device?.active_borrow_id){this.processing=!0;try{let r=yield this.borrowService.returnDevice(this.device.active_borrow_id);r.success?(this.snackBar.open("\u6B78\u9084\u6210\u529F\uFF01","\u95DC\u9589",{duration:3e3}),yield this.router.navigate(["/"])):this.snackBar.open(r.error||"\u6B78\u9084\u5931\u6557","\u95DC\u9589",{duration:5e3})}catch(r){console.error("Return error:",r),this.snackBar.open(r.message||"\u6B78\u9084\u5931\u6557","\u95DC\u9589",{duration:5e3})}finally{this.processing=!1}}}))})}openImageLightbox(e){e.image_url&&this.dialog.open(ce,{data:{imageUrl:e.image_url,title:e.name}})}formatDate(e){return e?new Date(e).toLocaleString("zh-TW",{month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}):""}static{this.\u0275fac=function(p){return new(p||t)(v(T),v(de),v(pe),v(ie),v(oe),v(B))}}static{this.\u0275cmp=y({type:t,selectors:[["app-device-page"]],standalone:!0,features:[O],decls:4,vars:3,consts:[[1,"device-page"],["class","loading",4,"ngIf"],["class","error-state",4,"ngIf"],["class","device-content",4,"ngIf"],[1,"loading"],["diameter","40"],[1,"error-state"],[1,"device-content"],["routerLink","/",1,"back-link"],[1,"device-card"],[1,"device-image",3,"click"],[3,"src","alt",4,"ngIf"],["class","no-image",4,"ngIf"],[1,"device-name"],[1,"device-detail"],[4,"ngIf"],["class","device-os",4,"ngIf"],["class","device-notes",4,"ngIf"],[1,"status-section"],[1,"status-badge"],["class","borrower-info",4,"ngIf"],["class","borrow-form",4,"ngIf"],["class","return-section",4,"ngIf"],["class","maintenance-notice",4,"ngIf"],[3,"src","alt"],[1,"no-image"],[1,"device-os"],[1,"device-notes"],[1,"borrower-info"],["class","borrow-time",4,"ngIf"],[1,"borrow-time"],[1,"borrow-form"],["appearance","outline",1,"full-width"],["matInput","","placeholder","\u8ACB\u8F38\u5165\u4F60\u7684\u540D\u5B57",3,"ngModelChange","ngModel","disabled"],["matInput","","type","email","placeholder","your@email.com",3,"ngModelChange","ngModel","disabled"],["matInput","","placeholder","\u4F8B\uFF1AiOS App \u6E2C\u8A66",3,"ngModelChange","ngModel","disabled"],["mat-raised-button","","color","primary",1,"full-width","action-btn",3,"click","disabled"],["diameter","20",4,"ngIf"],["diameter","20"],[1,"return-section"],["mat-raised-button","","color","warn",1,"full-width","action-btn",3,"click","disabled"],[1,"maintenance-notice"]],template:function(p,r){p&1&&(o(0,"div",0),l(1,me,4,0,"div",1)(2,ge,5,1,"div",2)(3,ke,27,18,"div",3),n()),p&2&&(i(),a("ngIf",r.loading),i(),a("ngIf",!r.loading&&r.error),i(),a("ngIf",!r.loading&&r.device))},dependencies:[F,k,j,z,L,N,q,W,U,R,H,G,K,J,Y,X,Q,$,Z,te,ee,ne,re,V,A],styles:[".device-page[_ngcontent-%COMP%]{min-height:100vh;background:var(--app-bg);padding:16px;display:flex;justify-content:center;align-items:flex-start}.device-content[_ngcontent-%COMP%]{width:100%;max-width:400px;display:flex;flex-direction:column;gap:8px}.loading[_ngcontent-%COMP%], .error-state[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;gap:16px;padding:48px;color:var(--app-text-muted)}.error-state[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:64px;width:64px;height:64px;color:var(--app-danger)}.device-card[_ngcontent-%COMP%]{width:100%;margin-top:0;border-radius:3px;overflow:hidden}.back-link[_ngcontent-%COMP%]{display:inline-flex;align-items:center;gap:6px;padding:4px 0;color:var(--app-text-muted);text-decoration:none}.back-link[_ngcontent-%COMP%]:hover{color:var(--app-text)}.back-link[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:18px;width:18px;height:18px}.device-image[_ngcontent-%COMP%]{width:100%;height:200px;background:var(--app-surface-elev);display:flex;align-items:center;justify-content:center;border-radius:3px 3px 0 0;overflow:hidden}.device-image.clickable[_ngcontent-%COMP%]{cursor:zoom-in}.device-image[_ngcontent-%COMP%]:not(.clickable){cursor:default}.device-image[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:100%;object-fit:cover;object-position:top center}.device-image[_ngcontent-%COMP%]   .no-image[_ngcontent-%COMP%]{color:var(--app-text-muted)}.device-image[_ngcontent-%COMP%]   .no-image[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:64px;width:64px;height:64px}.device-name[_ngcontent-%COMP%]{font-size:24px;font-weight:500;margin:16px 0 8px}.device-detail[_ngcontent-%COMP%]{font-size:16px;color:var(--app-text);margin:0 0 4px}.device-os[_ngcontent-%COMP%]{font-size:14px;color:var(--app-text-muted);margin:0 0 8px}.device-notes[_ngcontent-%COMP%]{font-size:14px;color:var(--app-text-muted);margin:8px 0;padding:8px;background:var(--app-surface);border-radius:3px}.status-section[_ngcontent-%COMP%]{margin:16px 0}.status-badge[_ngcontent-%COMP%]{display:inline-block;padding:6px 16px;border-radius:3px;font-size:14px;font-weight:500}.status-badge.available[_ngcontent-%COMP%]{background:var(--app-success-bg);color:var(--app-success)}.status-badge.borrowed[_ngcontent-%COMP%]{background:var(--app-danger-bg);color:var(--app-danger)}.status-badge.maintenance[_ngcontent-%COMP%]{background:var(--app-warning-bg);color:var(--app-warning)}.borrower-info[_ngcontent-%COMP%]{margin-top:12px;padding:12px;background:var(--app-danger-bg);border-radius:3px}.borrower-info[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0;font-size:14px}.borrower-info[_ngcontent-%COMP%]   .borrow-time[_ngcontent-%COMP%]{color:var(--app-text-muted);margin-top:4px}.borrow-form[_ngcontent-%COMP%], .return-section[_ngcontent-%COMP%]{padding:16px}.full-width[_ngcontent-%COMP%]{width:100%}.action-btn[_ngcontent-%COMP%]{height:48px;font-size:16px;margin-top:8px}.action-btn[_ngcontent-%COMP%]   mat-spinner[_ngcontent-%COMP%]{display:inline-block;margin-right:8px}.maintenance-notice[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;gap:8px;padding:24px;color:var(--app-text-muted)}.maintenance-notice[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:48px;width:48px;height:48px}"]})}}return t})();export{rt as DevicePageComponent};
