import{a as _e,b as ve}from"./chunk-5ZOMADD3.js";import{d as R,g as z}from"./chunk-PAKVZ7YK.js";import{a as xe,b as be}from"./chunk-KBFMTSVQ.js";import{a as ce,b as le,c as de,d as me,e as se,f as pe,g as ue,h as I,i as ge,j as fe}from"./chunk-HBF5AA77.js";import{a as U,c as G,d as H,f as J,g as Y,k as Z,l as ee,m as te,n as ie,o as ne,p as oe,q as ae,r as re}from"./chunk-IULNBF3J.js";import{b as j,ba as O,da as P,ea as K,f as W,fa as X,i as Q,l as q,o as $}from"./chunk-O6CXBG2O.js";import{$a as _,Ab as a,Bb as C,Cb as M,Eb as L,Fb as h,Gb as D,Ha as F,Hb as y,Ja as r,Jb as E,Ka as u,Lb as T,bb as l,db as k,ec as A,f as x,fc as N,gc as V,hb as n,ib as t,ic as S,jb as B,ka as w,nb as b,qb as g,ra as f,sa as v,sb as s}from"./chunk-RS4Y4S6U.js";var Ce=(()=>{class i{constructor(e,d){this.dialogRef=e,this.data=d,this.borrowerName="",this.borrowerEmail="",this.purpose=""}onConfirm(){if(this.borrowerName.trim()){let e={borrowerName:this.borrowerName.trim(),borrowerEmail:this.borrowerEmail.trim()||void 0,purpose:this.purpose.trim()||void 0};this.dialogRef.close(e)}}static{this.\u0275fac=function(d){return new(d||i)(u(ce),u(le))}}static{this.\u0275cmp=w({type:i,selectors:[["app-borrow-dialog"]],standalone:!0,features:[E],decls:20,vars:5,consts:[["mat-dialog-title",""],["appearance","outline",1,"full-width"],["matInput","","placeholder","\u8ACB\u8F38\u5165\u4F60\u7684\u540D\u5B57","required","",3,"ngModelChange","ngModel"],["matInput","","type","email","placeholder","your@email.com",3,"ngModelChange","ngModel"],["matInput","","placeholder","\u4F8B\uFF1AiOS App \u6E2C\u8A66",3,"ngModelChange","ngModel"],["align","end"],["mat-button","","mat-dialog-close",""],["mat-raised-button","","color","primary",3,"click","disabled"]],template:function(d,o){d&1&&(n(0,"h2",0),a(1),t(),n(2,"mat-dialog-content")(3,"mat-form-field",1)(4,"mat-label"),a(5,"\u4F60\u7684\u540D\u5B57"),t(),n(6,"input",2),y("ngModelChange",function(p){return D(o.borrowerName,p)||(o.borrowerName=p),p}),t()(),n(7,"mat-form-field",1)(8,"mat-label"),a(9,"Email\uFF08\u9078\u586B\uFF09"),t(),n(10,"input",3),y("ngModelChange",function(p){return D(o.borrowerEmail,p)||(o.borrowerEmail=p),p}),t()(),n(11,"mat-form-field",1)(12,"mat-label"),a(13,"\u501F\u7528\u7528\u9014\uFF08\u9078\u586B\uFF09"),t(),n(14,"input",4),y("ngModelChange",function(p){return D(o.purpose,p)||(o.purpose=p),p}),t()()(),n(15,"mat-dialog-actions",5)(16,"button",6),a(17,"\u53D6\u6D88"),t(),n(18,"button",7),g("click",function(){return o.onConfirm()}),a(19," \u78BA\u8A8D\u501F\u7528 "),t()()),d&2&&(r(),M("\u501F\u7528 ",o.data.deviceName,""),r(5),h("ngModel",o.borrowerName),r(4),h("ngModel",o.borrowerEmail),r(4),h("ngModel",o.purpose),r(4),l("disabled",!o.borrowerName.trim()))},dependencies:[S,$,j,W,q,Q,I,me,se,ue,pe,ee,Z,Y,ie,te,P,O],styles:["mat-dialog-content[_ngcontent-%COMP%]{min-width:300px;overflow:visible}.full-width[_ngcontent-%COMP%]{width:100%}mat-form-field[_ngcontent-%COMP%]{margin-top:4px}"]})}}return i})();var De=i=>["/device",i];function ye(i,m){i&1&&(n(0,"div",11),B(1,"mat-spinner",12),n(2,"span"),a(3,"\u8F09\u5165\u4E2D..."),t()())}function Ee(i,m){if(i&1){let e=b();n(0,"img",29),g("error",function(o){f(e);let c=s(3);return v(c.onImageError(o))}),t()}if(i&2){let e=s().$implicit;l("src",e.image_url,F)("alt",e.name)}}function Se(i,m){i&1&&(n(0,"div",30)(1,"mat-icon"),a(2,"phone_android"),t()())}function Oe(i,m){i&1&&(n(0,"span"),a(1,"\u53EF\u501F\u7528"),t())}function Pe(i,m){i&1&&(n(0,"span"),a(1,"\u5DF2\u501F\u51FA"),t())}function Ie(i,m){i&1&&(n(0,"span"),a(1,"\u7DAD\u4FEE\u4E2D"),t())}function Fe(i,m){if(i&1&&(n(0,"div",31)(1,"mat-icon"),a(2,"person"),t(),n(3,"span"),a(4),t()()),i&2){let e=s().$implicit;r(4),C(e.borrower_name)}}function ke(i,m){if(i&1){let e=b();n(0,"button",32),g("click",function(){f(e);let o=s().$implicit,c=s(2);return v(c.borrowDevice(o))}),n(1,"mat-icon"),a(2,"download"),t(),a(3," \u501F\u7528 "),t()}if(i&2){let e=s().$implicit;l("disabled",e.processing)}}function Be(i,m){if(i&1){let e=b();n(0,"button",33),g("click",function(){f(e);let o=s().$implicit,c=s(2);return v(c.returnDevice(o))}),n(1,"mat-icon"),a(2,"upload"),t(),a(3," \u6B78\u9084 "),t()}if(i&2){let e=s().$implicit;l("disabled",e.processing)}}function Le(i,m){i&1&&(n(0,"button",34),a(1," \u7DAD\u4FEE\u4E2D "),t())}function Te(i,m){if(i&1){let e=b();n(0,"mat-card",15)(1,"div",16),g("click",function(){let o=f(e).$implicit,c=s(2);return v(c.openImageLightbox(o))}),_(2,Ee,1,2,"img",17)(3,Se,3,0,"div",18),t(),n(4,"div",19),_(5,Oe,2,0,"span",20)(6,Pe,2,0,"span",20)(7,Ie,2,0,"span",20),t(),n(8,"mat-card-content")(9,"h3",21)(10,"a",22),a(11),t()(),n(12,"p",23),a(13),t(),_(14,Fe,5,1,"div",24),t(),n(15,"mat-card-actions")(16,"button",25),g("click",function(){let o=f(e).$implicit,c=s(2);return v(c.showQrCode(o))}),n(17,"mat-icon"),a(18,"qr_code"),t(),a(19," QR "),t(),_(20,ke,4,1,"button",26)(21,Be,4,1,"button",27)(22,Le,2,0,"button",28),t()()}if(i&2){let e=m.$implicit;r(),k("clickable",e.image_url),r(),l("ngIf",e.image_url),r(),l("ngIf",!e.image_url),r(),l("ngClass",e.status),r(),l("ngIf",e.status==="available"),r(),l("ngIf",e.status==="borrowed"),r(),l("ngIf",e.status==="maintenance"),r(3),l("routerLink",T(17,De,e.id)),r(),M(" ",e.name," "),r(2),L("",e.brand," \xB7 ",e.os," ",e.os_version,""),r(),l("ngIf",e.status==="borrowed"&&e.borrower_name),r(6),l("ngIf",e.status==="available"),r(),l("ngIf",e.status==="borrowed"),r(),l("ngIf",e.status==="maintenance")}}function Ae(i,m){if(i&1&&(n(0,"div",13),_(1,Te,23,19,"mat-card",14),t()),i&2){let e=s();r(),l("ngForOf",e.devices)}}function Ne(i,m){i&1&&(n(0,"div",35)(1,"mat-icon"),a(2,"devices"),t(),n(3,"p"),a(4,"\u76EE\u524D\u6C92\u6709\u4EFB\u4F55\u8A2D\u5099"),t()())}var _t=(()=>{class i{constructor(e,d,o,c){this.deviceService=e,this.borrowService=d,this.dialog=o,this.snackBar=c,this.devices=[],this.stats={total:0,available:0,borrowed:0,maintenance:0},this.loading=!0}ngOnInit(){return x(this,null,function*(){yield this.loadDevices()})}loadDevices(){return x(this,null,function*(){this.loading=!0;try{this.devices=yield this.deviceService.getDevices(),this.stats=yield this.deviceService.getStats()}catch(e){console.error("Error loading devices:",e),this.snackBar.open("\u8F09\u5165\u8A2D\u5099\u5931\u6557","\u95DC\u9589",{duration:3e3})}finally{this.loading=!1}})}showQrCode(e){this.dialog.open(be,{width:"350px",data:{deviceId:e.id,deviceName:e.name}})}openImageLightbox(e){e.image_url&&this.dialog.open(_e,{data:{imageUrl:e.image_url,title:e.name}})}onImageError(e){e.target.style.display="none"}borrowDevice(e){this.dialog.open(Ce,{width:"350px",data:{deviceName:e.name}}).afterClosed().subscribe(o=>x(this,null,function*(){if(o){e.processing=!0;try{let c=yield this.borrowService.borrowDevice(e.id,o.borrowerName,o.borrowerEmail,o.purpose);c.success?this.snackBar.open("\u501F\u7528\u6210\u529F\uFF01","\u95DC\u9589",{duration:3e3}):this.snackBar.open(c.error||"\u501F\u7528\u5931\u6557","\u95DC\u9589",{duration:5e3}),yield this.loadDevices()}catch(c){console.error("Borrow error:",c),this.snackBar.open(c.message||"\u501F\u7528\u5931\u6557","\u95DC\u9589",{duration:5e3}),yield this.loadDevices()}finally{e.processing=!1}}}))}returnDevice(e){this.dialog.open(ge,{width:"320px",data:{title:"\u78BA\u8A8D\u6B78\u9084",message:`\u78BA\u5B9A\u8981\u6B78\u9084\u300C${e.name}\u300D\u55CE\uFF1F`,confirmText:"\u78BA\u8A8D\u6B78\u9084",cancelText:"\u53D6\u6D88"}}).afterClosed().subscribe(o=>x(this,null,function*(){if(o&&e.active_borrow_id){e.processing=!0;try{let c=yield this.borrowService.returnDevice(e.active_borrow_id);c.success?this.snackBar.open("\u6B78\u9084\u6210\u529F\uFF01","\u95DC\u9589",{duration:3e3}):this.snackBar.open(c.error||"\u6B78\u9084\u5931\u6557","\u95DC\u9589",{duration:5e3}),yield this.loadDevices()}catch(c){console.error("Return error:",c),this.snackBar.open(c.message||"\u6B78\u9084\u5931\u6557","\u95DC\u9589",{duration:5e3}),yield this.loadDevices()}finally{e.processing=!1}}}))}static{this.\u0275fac=function(d){return new(d||i)(u(fe),u(ve),u(de),u(ae))}}static{this.\u0275cmp=w({type:i,selectors:[["app-device-list"]],standalone:!0,features:[E],decls:25,vars:6,consts:[[1,"device-list-container"],[1,"info-banner"],[1,"stats-row"],[1,"stat-card"],[1,"stat-number"],[1,"stat-label"],[1,"stat-card","available"],[1,"stat-card","borrowed"],["class","loading",4,"ngIf"],["class","device-grid",4,"ngIf"],["class","empty-state",4,"ngIf"],[1,"loading"],["diameter","40"],[1,"device-grid"],["class","device-card",4,"ngFor","ngForOf"],[1,"device-card"],[1,"device-image",3,"click"],[3,"src","alt","error",4,"ngIf"],["class","no-image",4,"ngIf"],[1,"status-badge",3,"ngClass"],[4,"ngIf"],[1,"device-name"],[1,"device-name-link",3,"routerLink"],[1,"device-info"],["class","borrower-info",4,"ngIf"],["mat-stroked-button","",3,"click"],["mat-flat-button","","color","primary",3,"disabled","click",4,"ngIf"],["mat-flat-button","","color","warn",3,"disabled","click",4,"ngIf"],["mat-stroked-button","","color","warn","disabled","",4,"ngIf"],[3,"error","src","alt"],[1,"no-image"],[1,"borrower-info"],["mat-flat-button","","color","primary",3,"click","disabled"],["mat-flat-button","","color","warn",3,"click","disabled"],["mat-stroked-button","","color","warn","disabled",""],[1,"empty-state"]],template:function(d,o){d&1&&(n(0,"div",0)(1,"div",1)(2,"mat-icon"),a(3,"qr_code_scanner"),t(),n(4,"span"),a(5,"\u6383\u63CF\u8A2D\u5099\u4E0A\u7684 QR Code \u5373\u53EF\u501F\u7528\u6216\u6B78\u9084"),t()(),n(6,"div",2)(7,"div",3)(8,"div",4),a(9),t(),n(10,"div",5),a(11,"\u7E3D\u8A2D\u5099"),t()(),n(12,"div",6)(13,"div",4),a(14),t(),n(15,"div",5),a(16,"\u53EF\u501F\u7528"),t()(),n(17,"div",7)(18,"div",4),a(19),t(),n(20,"div",5),a(21,"\u5DF2\u501F\u51FA"),t()()(),_(22,ye,4,0,"div",8)(23,Ae,2,1,"div",9)(24,Ne,5,0,"div",10),t()),d&2&&(r(9),C(o.stats.total),r(5),C(o.stats.available),r(5),C(o.stats.borrowed),r(3),l("ngIf",o.loading),r(),l("ngIf",!o.loading),r(),l("ngIf",!o.loading&&o.devices.length===0))},dependencies:[S,A,N,V,z,R,J,U,H,G,P,O,X,K,xe,oe,ne,I,re],styles:[".device-list-container[_ngcontent-%COMP%]{max-width:1200px;margin:0 auto}.info-banner[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;padding:12px 16px;background:transparent;border:1px solid rgba(227,229,232,.6);border-radius:3px;margin-bottom:16px;color:#e3e5e8d9}.info-banner[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:20px;width:20px;height:20px}.stats-row[_ngcontent-%COMP%]{display:flex;gap:16px;margin-bottom:24px}.stat-card[_ngcontent-%COMP%]{flex:1;background:var(--app-surface);border-radius:3px;padding:16px;text-align:center;box-shadow:0 2px 8px #00000059}.stat-number[_ngcontent-%COMP%]{font-size:32px;font-weight:500;color:var(--app-text)}.stat-label[_ngcontent-%COMP%]{font-size:14px;color:var(--app-text-muted)}.stat-card.available[_ngcontent-%COMP%]   .stat-number[_ngcontent-%COMP%]{color:var(--app-success)}.stat-card.borrowed[_ngcontent-%COMP%]   .stat-number[_ngcontent-%COMP%]{color:var(--app-danger)}.loading[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;gap:16px;padding:48px;color:var(--app-text-muted)}.device-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:16px}.device-card[_ngcontent-%COMP%]{display:flex;flex-direction:column;border-radius:3px;overflow:hidden;background:var(--app-surface)}.device-image[_ngcontent-%COMP%]{width:100%;height:180px;background:var(--app-surface-elev);display:flex;align-items:center;justify-content:center;overflow:hidden;cursor:pointer}.device-image[_ngcontent-%COMP%]:hover{opacity:.9}.device-image.clickable[_ngcontent-%COMP%]{cursor:zoom-in}.device-image[_ngcontent-%COMP%]:not(.clickable){cursor:default}.device-image[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:100%;object-fit:cover;object-position:top center}.no-image[_ngcontent-%COMP%]{color:var(--app-text-muted)}.no-image[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:64px;width:64px;height:64px}.status-badge[_ngcontent-%COMP%]{display:inline-block;padding:4px 12px;border-radius:3px;font-size:12px;font-weight:500;margin:12px 16px 0;width:fit-content}.status-badge.available[_ngcontent-%COMP%]{background:var(--app-success-bg);color:var(--app-success)}.status-badge.borrowed[_ngcontent-%COMP%]{background:var(--app-danger-bg);color:var(--app-danger)}.status-badge.maintenance[_ngcontent-%COMP%]{background:var(--app-warning-bg);color:var(--app-warning)}mat-card-content[_ngcontent-%COMP%]{flex:1;padding:16px!important}.device-name[_ngcontent-%COMP%]{margin:0 0 4px;font-size:18px;font-weight:500}.device-name-link[_ngcontent-%COMP%]{color:inherit;text-decoration:none}.device-name-link[_ngcontent-%COMP%]:hover{text-decoration:underline}.device-info[_ngcontent-%COMP%]{margin:0;font-size:14px;color:var(--app-text-muted)}.borrower-info[_ngcontent-%COMP%]{display:flex;align-items:center;gap:4px;margin-top:8px;font-size:12px;color:var(--app-text-muted)}.borrower-info[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:16px;width:16px;height:16px}mat-card-actions[_ngcontent-%COMP%]{padding:8px 16px 16px!important;display:flex;gap:8px}mat-card-actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{flex:1}mat-card-actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{margin-right:4px}.empty-state[_ngcontent-%COMP%]{text-align:center;padding:48px;color:var(--app-text-muted)}.empty-state[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:64px;width:64px;height:64px;margin-bottom:16px}@media (max-width: 600px){.stats-row[_ngcontent-%COMP%]{flex-wrap:wrap}.stat-card[_ngcontent-%COMP%]{min-width:calc(50% - 8px)}.device-grid[_ngcontent-%COMP%]{grid-template-columns:1fr}}"]})}}return i})();export{_t as DeviceListComponent};
